"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[366],{5011:function(e,t,a){a.d(t,{A:function(){return s}});a(4114),a(4979);var i=a(5129),o=a(1219),n=a(9325);async function s(e,t={}){const a=i.A.getters.credentials||btoa("unset:unset");t.headers={...t.headers,Authorization:`Basic ${a}`},t.credentials="include";const s=await fetch(e,t);return 401===s.status&&(o.nk.error("认证状态错误，请重新登录"),n.A.push("/adminLogin")),s}},7366:function(e,t,a){a.r(t),a.d(t,{default:function(){return y}});var i=a(6768),o=a(4232);const n={class:"container"},s={class:"header-content"},l={class:"header-action"},r={class:"main-container"},d={style:{margin:"8px"}},c=["src"],u={key:2,style:{width:"100px",height:"100px",display:"flex","justify-content":"center","align-items":"center"}},h={class:"pagination-container"};function g(e,t,a,g,m,p){const b=(0,i.g2)("DashboardTabs"),k=(0,i.g2)("font-awesome-icon"),f=(0,i.g2)("el-tooltip"),y=(0,i.g2)("el-header"),C=(0,i.g2)("el-table-column"),v=(0,i.g2)("el-image"),w=(0,i.g2)("el-table"),x=(0,i.g2)("el-switch"),D=(0,i.g2)("el-pagination"),T=(0,i.g2)("el-button"),L=(0,i.gN)("loading");return(0,i.uX)(),(0,i.CE)("div",n,[(0,i.bF)(y,null,{default:(0,i.k6)(()=>[(0,i.Lk)("div",s,[(0,i.bF)(b,{activeTab:"customerConfig"}),(0,i.Lk)("div",l,[(0,i.bF)(f,{disabled:p.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,i.k6)(()=>[(0,i.bF)(k,{icon:"sign-out-alt",class:"header-icon",onClick:p.handleLogout},null,8,["onClick"])]),_:1},8,["disabled"])])])]),_:1}),(0,i.Lk)("div",r,[(0,i.bo)(((0,i.uX)(),(0,i.Wv)(w,{data:p.paginatedData,"default-sort":{prop:"count",order:"descending"},class:"main-table","table-layout":"fixed"},{default:(0,i.k6)(()=>[(0,i.bF)(C,{type:"expand"},{default:(0,i.k6)(e=>[(0,i.Lk)("div",d,[t[0]||(t[0]=(0,i.Lk)("h3",{style:{"text-align":"center"}},"上传文件列表",-1)),(0,i.bF)(w,{data:e.row.data,style:{width:"100%"},"default-sort":{prop:"metadata.TimeStamp",order:"descending"},"table-layout":"fixed","max-height":400},{default:(0,i.k6)(()=>[(0,i.bF)(C,{prop:"metadata.FileName",label:"文件名"}),(0,i.bF)(C,{label:"文件预览"},{default:(0,i.k6)(({row:e})=>[e.metadata?.FileType?.includes("image")?((0,i.uX)(),(0,i.Wv)(v,{key:0,src:"/file/"+e.id+"?from=admin",fit:"cover",lazy:"",style:{width:"100px",height:"100px"}},null,8,["src"])):e.metadata?.FileType?.includes("video")?((0,i.uX)(),(0,i.CE)("video",{key:1,src:"/file/"+e.id+"?from=admin",controls:"",style:{width:"100px",height:"100px"}},null,8,c)):((0,i.uX)(),(0,i.CE)("div",u,[(0,i.bF)(k,{icon:"file",style:{"font-size":"2em"}})]))]),_:1}),(0,i.bF)(C,{formatter:p.formatTimeStamp,label:"上传时间",prop:"metadata.TimeStamp",sortable:"","sort-method":p.sortByTimestamp},{default:(0,i.k6)(({row:e})=>[(0,i.eW)((0,o.v_)(p.formatTimeStamp(e.metadata.TimeStamp)),1)]),_:1},8,["formatter","sort-method"])]),_:1},8,["data"])])]),_:1}),(0,i.bF)(C,{prop:"ip",label:"IP地址"}),(0,i.bF)(C,{prop:"address",label:"地址"}),(0,i.bF)(C,{prop:"count",label:"上传次数",sortable:""}),(0,i.bF)(C,{label:"允许上传"},{default:(0,i.k6)(({row:e})=>[(0,i.bF)(x,{modelValue:e.enable,"onUpdate:modelValue":t=>e.enable=t,"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"允许","inactive-text":"禁止",onChange:t=>p.handleSwitchEnable(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})]),_:1},8,["data"])),[[L,m.loading]]),(0,i.Lk)("div",h,[(0,i.bF)(D,{background:"",layout:"prev, pager, next",total:m.dealedData.length,"current-page":m.currentPage,"page-size":m.pageSize,"pager-count":p.pagerCount,onCurrentChange:p.handlePageChange},null,8,["total","current-page","page-size","pager-count","onCurrentChange"]),m.currentPage===Math.ceil(m.dealedData.length/m.pageSize)?((0,i.uX)(),(0,i.Wv)(T,{key:0,type:"primary",onClick:p.loadMoreData,loading:m.loading,class:"load-more"},{default:(0,i.k6)(()=>[...t[1]||(t[1]=[(0,i.eW)("加载更多",-1)])]),_:1},8,["onClick","loading"])):(0,i.Q3)("",!0)])])])}a(4114),a(8111),a(2489),a(1701);var m=a(5011),p=a(9252),b={name:"CustomerConfig",data(){return{tableData:[],dealedData:[],blockipList:[],loading:!1,currentPage:1,pageSize:10}},components:{DashboardTabs:p.A},computed:{disableTooltip(){return window.innerWidth<768},pagerCount(){return window.innerWidth<768?3:7},paginatedData(){const e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.dealedData.slice(e,t)}},methods:{handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},formatTimeStamp(e){return new Date(e).toLocaleString()},sortByTimestamp(e,t){return new Date(e.metadata.TimeStamp)-new Date(t.metadata.TimeStamp)},async handleSwitchEnable(e){const t=e.ip,a=e.enable;a?(this.blockipList=this.blockipList.filter(e=>e!==t),await(0,m.A)("/api/manage/cusConfig/whiteip",{method:"POST",body:t})):(this.blockipList.push(t),await(0,m.A)("/api/manage/cusConfig/blockip",{method:"POST",body:t}))},handlePageChange(e){this.currentPage=e,e===Math.ceil(this.dealedData.length/this.pageSize)&&this.loadMoreData()},loadMoreData(){this.loading=!0;const e=this.dealedData.length,t=20;(0,m.A)(`/api/manage/cusConfig/list?start=${e}&count=${t}`,{method:"GET"}).then(e=>e.json()).then(e=>{this.dealedData=this.dealedData.concat(e.map(e=>{const t=!this.blockipList.includes(e.ip);return{ip:e.ip,address:e.address,count:e.count,data:e.data,enable:t}}))}).catch(()=>{this.$message.error("加载更多数据时出错，请检查网络连接")}).finally(()=>{this.loading=!1})},handleSizeChange(e){this.pageSize=e,this.currentPage=1}},mounted(){this.loading=!0,(0,m.A)("/api/manage/check",{method:"GET"}).then(e=>e.text()).then(e=>{if("true"==e)return this.showLogoutButton=!0,(0,m.A)("/api/manage/cusConfig/list?count=20",{method:"GET"});if("Not using basic auth."==e)return(0,m.A)("/api/manage/cusConfig/list?count=20",{method:"GET"});throw new Error("Unauthorized")}).then(e=>e.json()).then(async e=>{const t=await(0,m.A)("/api/manage/cusConfig/blockipList",{method:"GET"});this.blockipList=(await t.text()).split(","),this.dealedData=e.map(e=>{const t=!this.blockipList.includes(e.ip);return{ip:e.ip,address:e.address,count:e.count,data:e.data,enable:t}})}).catch(e=>{"Unauthorized"!==e.message&&this.$message.error("同步数据时出错，请检查网络连接")}).finally(()=>{this.loading=!1})}},k=a(1241);const f=(0,k.A)(b,[["render",g],["__scopeId","data-v-1c7a5eff"]]);var y=f},9252:function(e,t,a){a.d(t,{A:function(){return C}});var i=a(6768),o=a(4232);const n={class:"tabs"},s={class:"tabs-dropdown-link"};function l(e,t,a,l,r,d){const c=(0,i.g2)("font-awesome-icon"),u=(0,i.g2)("el-dropdown-item"),h=(0,i.g2)("el-dropdown-menu"),g=(0,i.g2)("el-dropdown"),m=(0,i.g2)("AdminToggleDark");return(0,i.uX)(),(0,i.CE)("div",n,[(0,i.Lk)("span",{class:"title",onClick:t[0]||(t[0]=(...e)=>d.refreshDashboard&&d.refreshDashboard(...e))},[(0,i.bF)(c,{icon:d.iconName,class:"fa-images"},null,8,["icon"]),(0,i.eW)(" "+(0,o.v_)(d.titleName),1)]),(0,i.bF)(g,{onCommand:d.handleTabClick,class:"tabs-dropdown",role:"navigation",onVisibleChange:d.handleDropdownVisible,"popper-class":"tabs-dropdown-popper"},{dropdown:(0,i.k6)(()=>[(0,i.bF)(h,null,{default:(0,i.k6)(()=>["dashboard"!==a.activeTab?((0,i.uX)(),(0,i.Wv)(u,{key:0,command:"dashboard"},{default:(0,i.k6)(()=>[(0,i.bF)(c,{icon:"images",style:{"margin-right":"5px",width:"16px"}}),t[1]||(t[1]=(0,i.eW)(" 文件管理 ",-1))]),_:1})):(0,i.Q3)("",!0),"customerConfig"!==a.activeTab?((0,i.uX)(),(0,i.Wv)(u,{key:1,command:"customerConfig"},{default:(0,i.k6)(()=>[(0,i.bF)(c,{icon:"user-cog",style:{"margin-right":"5px",width:"16px"}}),t[2]||(t[2]=(0,i.eW)(" 用户管理 ",-1))]),_:1})):(0,i.Q3)("",!0),"systemConfig"!==a.activeTab?((0,i.uX)(),(0,i.Wv)(u,{key:2,command:"systemConfig"},{default:(0,i.k6)(()=>[(0,i.bF)(c,{icon:"cogs",style:{"margin-right":"5px",width:"16px"}}),t[3]||(t[3]=(0,i.eW)(" 系统设置 ",-1))]),_:1})):(0,i.Q3)("",!0),(0,i.bF)(u,{command:""},{default:(0,i.k6)(()=>[(0,i.bF)(c,{icon:"upload",style:{"margin-right":"5px",width:"16px"}}),t[4]||(t[4]=(0,i.eW)(" 文件上传 ",-1))]),_:1})]),_:1})]),default:(0,i.k6)(()=>[(0,i.Lk)("span",s,[(0,i.bF)(c,{icon:"bars",class:"tabs-arrow"})])]),_:1},8,["onCommand","onVisibleChange"]),(0,i.bF)(m)])}a(4114);var r=a(5130);const d={id:"themeMaskAdmin"},c=["cx","cy","r"],u=["r"],h=["opacity"];function g(e,t,a,n,s,l){const g=(0,i.g2)("font-awesome-icon");return(0,i.uX)(),(0,i.CE)("div",{id:"themeToggle",onClick:t[0]||(t[0]=(...e)=>l.handleToggleClick&&l.handleToggleClick(...e))},[(0,i.bF)(r.eB,{name:"icon-fade",mode:"out-in"},{default:(0,i.k6)(()=>[s.isAuto?((0,i.uX)(),(0,i.Wv)(g,{key:"auto-mode",icon:"circle-half-stroke",class:"auto-icon",style:{"font-size":"1.3em",color:"var(--admin-theme-toggle-color)"}})):((0,i.uX)(),(0,i.CE)("svg",{key:"sun-moon",class:(0,o.C4)(["theme_toggle_svg",{dark:s.isDark}]),width:"1.3em",height:"1.3em",viewBox:"0 0 24 24",fill:"none","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",stroke:"currentColor"},[(0,i.Lk)("mask",d,[t[1]||(t[1]=(0,i.Lk)("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"white"},null,-1)),(0,i.Lk)("circle",{class:"theme_toggle_circle1",fill:"black",cx:s.isDark?"50%":"100%",cy:s.isDark?"23%":"0%",r:s.isDark?"9":"5"},null,8,c)]),(0,i.Lk)("circle",{class:"theme_toggle_circle2",cx:"12",cy:"12",r:s.isDark?"9":"5",mask:"url(#themeMaskAdmin)"},null,8,u),(0,i.Lk)("g",{class:"theme_toggle_g",stroke:"currentColor",opacity:s.isDark?0:1},[...t[2]||(t[2]=[(0,i.Lk)("line",{x1:"12",y1:"1",x2:"12",y2:"3"},null,-1),(0,i.Lk)("line",{x1:"12",y1:"21",x2:"12",y2:"23"},null,-1),(0,i.Lk)("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"},null,-1),(0,i.Lk)("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"},null,-1),(0,i.Lk)("line",{x1:"1",y1:"12",x2:"3",y2:"12"},null,-1),(0,i.Lk)("line",{x1:"21",y1:"12",x2:"23",y2:"12"},null,-1),(0,i.Lk)("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"},null,-1),(0,i.Lk)("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"},null,-1)])],8,h)],2))]),_:1})])}var m={name:"ToggleDark",data(){return{isDark:this.$store.getters.useDarkMode,isAuto:!this.$store.getters.cusDarkMode}},methods:{handleToggleClick(){this.isAuto?(this.isDark=!1,this.isAuto=!1,this.$store.commit("setCusDarkMode",!0),this.$store.commit("setUseDarkMode",!1)):this.isDark?(this.isAuto=!0,this.$store.commit("setCusDarkMode",!1)):(this.isDark=!0,this.$store.commit("setCusDarkMode",!0),this.$store.commit("setUseDarkMode",!0))}}},p=a(1241);const b=(0,p.A)(m,[["render",g],["__scopeId","data-v-4c6ec90c"]]);var k=b,f={name:"DashboardTabs",props:{activeTab:{type:String,default:"dashboard"}},components:{AdminToggleDark:k},computed:{titleName(){return"dashboard"===this.activeTab?"文件管理":"customerConfig"===this.activeTab?"用户管理":"systemConfig"===this.activeTab?"系统设置":"上传页面"},iconName(){return"dashboard"===this.activeTab?"images":"customerConfig"===this.activeTab?"user-cog":"systemConfig"===this.activeTab?"cogs":"upload"}},methods:{refreshDashboard(){location.reload()},handleTabClick(e){this.$router.push(`/${e}`)},handleDropdownVisible(e){const t=document.querySelector(".tabs-dropdown-link");e?t.classList.add("rotate-up"):t.classList.remove("rotate-up")}}};const y=(0,p.A)(f,[["render",l],["__scopeId","data-v-4673d77a"]]);var C=y}}]);
//# sourceMappingURL=366.9ffb9a2a.js.map