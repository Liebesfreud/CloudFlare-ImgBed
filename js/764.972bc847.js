(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[764],{1393:function(e,t,o){o(6573),o(8100),o(7936),o(9577),o(1549),o(9797),o(9631),o(5623),o(4979),o(4603),o(7566),o(8721),function(t,o){e.exports=o()}(0,function(){return function(e){var t={};function o(l){if(t[l])return t[l].exports;var a=t[l]={i:l,l:!1,exports:{}};return e[l].call(a.exports,a,a.exports,o),a.l=!0,a.exports}return o.m=e,o.c=t,o.d=function(e,t,l){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(o.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(l,a,function(t){return e[t]}.bind(null,a));return l},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";var l;function a(e){return["image/png","image/jpeg","image/gif"].some(t=>t===e)}o.r(t),o.d(t,"canvastoDataURL",function(){return s}),o.d(t,"canvastoFile",function(){return r}),o.d(t,"dataURLtoFile",function(){return d}),o.d(t,"dataURLtoImage",function(){return u}),o.d(t,"downloadFile",function(){return c}),o.d(t,"filetoDataURL",function(){return h}),o.d(t,"imagetoCanvas",function(){return m}),o.d(t,"urltoBlob",function(){return f}),o.d(t,"urltoImage",function(){return g}),o.d(t,"compress",function(){return b}),o.d(t,"compressAccurately",function(){return y}),o.d(t,"EImageType",function(){return l}),function(e){e.PNG="image/png",e.JPEG="image/jpeg",e.GIF="image/gif"}(l||(l={}));var i=function(e,t,o,l){return new(o||(o=Promise))(function(a,i){function s(e){try{n(l.next(e))}catch(e){i(e)}}function r(e){try{n(l.throw(e))}catch(e){i(e)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,r)}n((l=l.apply(e,t||[])).next())})};function s(e,t=.92,o=l.JPEG){return i(this,void 0,void 0,function*(){return a(o)||(o=l.JPEG),e.toDataURL(o,t)})}function r(e,t=.92,o=l.JPEG){return new Promise(l=>e.toBlob(e=>l(e),o,t))}var n=function(e,t,o,l){return new(o||(o=Promise))(function(a,i){function s(e){try{n(l.next(e))}catch(e){i(e)}}function r(e){try{n(l.throw(e))}catch(e){i(e)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,r)}n((l=l.apply(e,t||[])).next())})};function d(e,t){return n(this,void 0,void 0,function*(){const o=e.split(",");let l=o[0].match(/:(.*?);/)[1];const i=atob(o[1]);let s=i.length;const r=new Uint8Array(s);for(;s--;)r[s]=i.charCodeAt(s);return a(t)&&(l=t),new Blob([r],{type:l})})}function u(e){return new Promise((t,o)=>{const l=new Image;l.onload=()=>t(l),l.onerror=()=>o(new Error("dataURLtoImage(): dataURL is illegal")),l.src=e})}function c(e,t){const o=document.createElement("a");o.href=window.URL.createObjectURL(e),o.download=t||Date.now().toString(36),document.body.appendChild(o);const l=document.createEvent("MouseEvents");l.initEvent("click",!1,!1),o.dispatchEvent(l),document.body.removeChild(o)}function h(e){return new Promise(t=>{const o=new FileReader;o.onloadend=e=>t(e.target.result),o.readAsDataURL(e)})}var p=function(e,t,o,l){return new(o||(o=Promise))(function(a,i){function s(e){try{n(l.next(e))}catch(e){i(e)}}function r(e){try{n(l.throw(e))}catch(e){i(e)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,r)}n((l=l.apply(e,t||[])).next())})};function m(e,t={}){return p(this,void 0,void 0,function*(){const o=Object.assign({},t),l=document.createElement("canvas"),a=l.getContext("2d");let i,s;for(const e in o)Object.prototype.hasOwnProperty.call(o,e)&&(o[e]=Number(o[e]));if(o.scale){const t=o.scale>0&&o.scale<10?o.scale:1;s=e.width*t,i=e.height*t}else s=o.width||o.height*e.width/e.height||e.width,i=o.height||o.width*e.height/e.width||e.height;switch([5,6,7,8].some(e=>e===o.orientation)?(l.height=s,l.width=i):(l.height=i,l.width=s),o.orientation){case 3:a.rotate(180*Math.PI/180),a.drawImage(e,-l.width,-l.height,l.width,l.height);break;case 6:a.rotate(90*Math.PI/180),a.drawImage(e,0,-l.width,l.height,l.width);break;case 8:a.rotate(270*Math.PI/180),a.drawImage(e,-l.height,0,l.height,l.width);break;case 2:a.translate(l.width,0),a.scale(-1,1),a.drawImage(e,0,0,l.width,l.height);break;case 4:a.translate(l.width,0),a.scale(-1,1),a.rotate(180*Math.PI/180),a.drawImage(e,-l.width,-l.height,l.width,l.height);break;case 5:a.translate(l.width,0),a.scale(-1,1),a.rotate(90*Math.PI/180),a.drawImage(e,0,-l.width,l.height,l.width);break;case 7:a.translate(l.width,0),a.scale(-1,1),a.rotate(270*Math.PI/180),a.drawImage(e,-l.height,0,l.height,l.width);break;default:a.drawImage(e,0,0,l.width,l.height)}return l})}function f(e){return fetch(e).then(e=>e.blob())}function g(e){return new Promise((t,o)=>{const l=new Image;l.onload=()=>t(l),l.onerror=()=>o(new Error("urltoImage(): Image failed to load, please check the image URL")),l.src=e})}var v=function(e,t,o,l){return new(o||(o=Promise))(function(a,i){function s(e){try{n(l.next(e))}catch(e){i(e)}}function r(e){try{n(l.throw(e))}catch(e){i(e)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,r)}n((l=l.apply(e,t||[])).next())})};function b(e,t={}){return v(this,void 0,void 0,function*(){if(!(e instanceof Blob))throw new Error("compress(): First arg must be a Blob object or a File object.");if("object"!=typeof t&&(t=Object.assign({quality:t})),t.quality=Number(t.quality),Number.isNaN(t.quality))return e;const o=yield h(e);let i=o.split(",")[0].match(/:(.*?);/)[1],r=l.JPEG;a(t.type)&&(r=t.type,i=t.type);const n=yield u(o),c=yield m(n,Object.assign({},t)),p=yield s(c,t.quality,r),f=yield d(p,i);return f.size>e.size?e:f})}function y(e,t={}){return v(this,void 0,void 0,function*(){if(!(e instanceof Blob))throw new Error("compressAccurately(): First arg must be a Blob object or a File object.");if("object"!=typeof t&&(t=Object.assign({size:t})),t.size=Number(t.size),Number.isNaN(t.size))return e;if(1024*t.size>e.size)return e;t.accuracy=Number(t.accuracy),(!t.accuracy||t.accuracy<.8||t.accuracy>.99)&&(t.accuracy=.95);const o=t.size*(2-t.accuracy)*1024,i=1024*t.size,r=t.size*t.accuracy*1024,n=yield h(e);let c=n.split(",")[0].match(/:(.*?);/)[1],p=l.JPEG;a(t.type)&&(p=t.type,c=t.type);const f=yield u(n),g=yield m(f,Object.assign({},t));let v,b=.5;const y=[null,null];for(let e=1;e<=7;e++){v=yield s(g,b,p);const t=.75*v.length;if(7===e){(o<t||r>t)&&(v=[v,...y].filter(e=>e).sort((e,t)=>Math.abs(.75*e.length-i)-Math.abs(.75*t.length-i))[0]);break}if(o<t)y[1]=v,b-=Math.pow(.5,e+1);else{if(!(r>t))break;y[0]=v,b+=Math.pow(.5,e+1)}}const C=yield d(v,c);return C.size>e.size?e:C})}}])})},3107:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return Le}});var l=o(6768),a=o(4232);const i={class:"top-toolbar d-none d-md-flex align-center"},s={class:"d-md-none mobile-menu"},r={class:"bottom-toolbar"},n={class:"header text-center mb-8"},d={class:"text-h3 font-weight-light title-text"},u={href:"https://github.com/MarSeventh/CloudFlare-ImgBed",target:"_blank",class:"text-decoration-none main-title"},c={class:"d-flex align-center justify-space-between mb-2"},h={key:0},p={key:0,class:"px-4"},m={class:"text-caption mb-1"},f={class:"text-caption mb-1"};function g(e,t,o,g,v,b){const y=(0,l.g2)("v-icon"),C=(0,l.g2)("v-btn"),k=(0,l.g2)("el-tooltip"),w=(0,l.g2)("v-text-field"),F=(0,l.g2)("v-tooltip"),U=(0,l.g2)("ToggleDark"),x=(0,l.g2)("v-list-item-title"),L=(0,l.g2)("v-list-item"),_=(0,l.g2)("v-list"),M=(0,l.g2)("v-menu"),S=(0,l.g2)("v-fab"),$=(0,l.g2)("v-speed-dial"),R=(0,l.g2)("Logo"),T=(0,l.g2)("UploadForm"),D=(0,l.g2)("v-row"),E=(0,l.g2)("v-toolbar-title"),I=(0,l.g2)("v-spacer"),N=(0,l.g2)("v-toolbar"),P=(0,l.g2)("v-radio"),W=(0,l.g2)("v-radio-group"),A=(0,l.g2)("v-divider"),V=(0,l.g2)("v-switch"),z=(0,l.g2)("v-expand-transition"),j=(0,l.g2)("v-card-text"),H=(0,l.g2)("v-card-actions"),B=(0,l.g2)("v-card"),X=(0,l.g2)("v-dialog"),Q=(0,l.g2)("v-list-subheader"),O=(0,l.g2)("v-select"),G=(0,l.g2)("v-list-item-subtitle"),J=(0,l.g2)("v-slider"),q=(0,l.g2)("v-card-title"),K=(0,l.g2)("UploadHistory"),Y=(0,l.g2)("Footer"),Z=(0,l.g2)("v-container");return(0,l.uX)(),(0,l.Wv)(Z,{fluid:"",class:"upload-home pa-0 fill-height"},{default:(0,l.k6)(()=>[t[53]||(t[53]=(0,l.Lk)("div",{class:"background-overlay"},null,-1)),(0,l.Lk)("div",i,[(0,l.bF)(k,{content:"查看文档",location:"bottom"},{default:(0,l.k6)(()=>[(0,l.bF)(C,{icon:"",color:"surface",variant:"elevated",class:"mx-1",href:"https://cfbed.sanyue.de/qa/",target:"_blank"},{default:(0,l.k6)(()=>[(0,l.bF)(y,null,{default:(0,l.k6)(()=>[...t[25]||(t[25]=[(0,l.eW)("mdi-book-open-variant",-1)])]),_:1})]),_:1})]),_:1}),(0,l.bF)(w,{modelValue:v.uploadFolder,"onUpdate:modelValue":t[0]||(t[0]=e=>v.uploadFolder=e),placeholder:"上传目录",variant:"solo",density:"compact","hide-details":"",class:"mx-1 upload-folder-input",style:{width:"150px"},"bg-color":"surface"},null,8,["modelValue"]),(0,l.bF)(F,{location:"bottom",text:"切换上传方式"},{activator:(0,l.k6)(({props:e})=>[(0,l.bF)(C,(0,l.v6)({icon:"",color:"surface",variant:"elevated",class:"mx-1"},e,{onClick:b.handleChangeUploadMethod}),{default:(0,l.k6)(()=>[(0,l.bF)(y,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,a.v_)("default"===v.uploadMethod?"mdi-folder-open":"mdi-content-paste"),1)]),_:1})]),_:1},16,["onClick"])]),_:1}),(0,l.bF)(F,{location:"bottom",text:"上传记录"},{activator:(0,l.k6)(({props:e})=>[(0,l.bF)(C,(0,l.v6)({icon:"",color:"surface",variant:"elevated",class:"mx-1"},e,{onClick:t[1]||(t[1]=e=>v.showHistory=!0)}),{default:(0,l.k6)(()=>[(0,l.bF)(y,null,{default:(0,l.k6)(()=>[...t[26]||(t[26]=[(0,l.eW)("mdi-history",-1)])]),_:1})]),_:1},16)]),_:1}),b.announcementAvailable?((0,l.uX)(),(0,l.Wv)(F,{key:0,location:"bottom",text:"查看公告"},{activator:(0,l.k6)(({props:e})=>[(0,l.bF)(C,(0,l.v6)({icon:"",color:"surface",variant:"elevated",class:"mx-1"},e,{onClick:b.handleShowAnnouncement}),{default:(0,l.k6)(()=>[(0,l.bF)(y,null,{default:(0,l.k6)(()=>[...t[27]||(t[27]=[(0,l.eW)("mdi-bullhorn",-1)])]),_:1})]),_:1},16,["onClick"])]),_:1})):(0,l.Q3)("",!0),(0,l.bF)(U,{class:"ml-2"})]),(0,l.Lk)("div",s,[(0,l.bF)(M,null,{activator:(0,l.k6)(({props:e})=>[(0,l.bF)(C,(0,l.v6)({icon:"mdi-dots-vertical",color:"surface",variant:"elevated"},e),null,16)]),default:(0,l.k6)(()=>[(0,l.bF)(_,null,{default:(0,l.k6)(()=>[(0,l.bF)(L,{onClick:t[2]||(t[2]=e=>b.handleMobileMenuCommand("toggleTheme"))},{prepend:(0,l.k6)(()=>[(0,l.bF)(y,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,a.v_)(b.getThemeIcon()),1)]),_:1})]),default:(0,l.k6)(()=>[(0,l.bF)(x,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,a.v_)(b.getThemeText()),1)]),_:1})]),_:1}),(0,l.bF)(L,{onClick:t[3]||(t[3]=e=>b.handleMobileMenuCommand("toggleUploadMethod"))},{prepend:(0,l.k6)(()=>[(0,l.bF)(y,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,a.v_)("default"===v.uploadMethod?"mdi-content-paste":"mdi-folder-open"),1)]),_:1})]),default:(0,l.k6)(()=>[(0,l.bF)(x,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,a.v_)("default"===v.uploadMethod?"粘贴上传":"文件上传"),1)]),_:1})]),_:1}),(0,l.bF)(L,{onClick:t[4]||(t[4]=e=>v.showHistory=!0)},{prepend:(0,l.k6)(()=>[(0,l.bF)(y,null,{default:(0,l.k6)(()=>[...t[28]||(t[28]=[(0,l.eW)("mdi-history",-1)])]),_:1})]),default:(0,l.k6)(()=>[(0,l.bF)(x,null,{default:(0,l.k6)(()=>[...t[29]||(t[29]=[(0,l.eW)("上传记录",-1)])]),_:1})]),_:1}),b.announcementAvailable?((0,l.uX)(),(0,l.Wv)(L,{key:0,onClick:b.handleShowAnnouncement},{prepend:(0,l.k6)(()=>[(0,l.bF)(y,null,{default:(0,l.k6)(()=>[...t[30]||(t[30]=[(0,l.eW)("mdi-bullhorn",-1)])]),_:1})]),default:(0,l.k6)(()=>[(0,l.bF)(x,null,{default:(0,l.k6)(()=>[...t[31]||(t[31]=[(0,l.eW)("查看公告",-1)])]),_:1})]),_:1},8,["onClick"])):(0,l.Q3)("",!0)]),_:1})]),_:1})]),(0,l.Lk)("div",r,[(0,l.bF)($,{location:"top",transition:"slide-y-reverse-transition"},{activator:(0,l.k6)(({props:e})=>[(0,l.bF)(S,(0,l.v6)(e,{size:"large",icon:"mdi-cog",color:"primary"}),null,16)]),default:(0,l.k6)(()=>[(0,l.bF)(C,{key:"1",icon:"mdi-cloud-upload",color:"surface",variant:"elevated",onClick:b.openCompressDialog,size:"small"},{default:(0,l.k6)(()=>[(0,l.bF)(F,{activator:"parent",location:"left"},{default:(0,l.k6)(()=>[...t[32]||(t[32]=[(0,l.eW)("上传设置",-1)])]),_:1})]),_:1},8,["onClick"]),(0,l.bF)(C,{key:"2",icon:"mdi-link",color:"surface",variant:"elevated",onClick:b.openUrlDialog,size:"small"},{default:(0,l.k6)(()=>[(0,l.bF)(F,{activator:"parent",location:"left"},{default:(0,l.k6)(()=>[...t[33]||(t[33]=[(0,l.eW)("链接格式",-1)])]),_:1})]),_:1},8,["onClick"]),(0,l.bF)(C,{key:"3",icon:"mdi-view-dashboard",color:"surface",variant:"elevated",onClick:b.handleManage,size:"small"},{default:(0,l.k6)(()=>[(0,l.bF)(F,{activator:"parent",location:"left"},{default:(0,l.k6)(()=>[...t[34]||(t[34]=[(0,l.eW)("系统管理",-1)])]),_:1})]),_:1},8,["onClick"]),(0,l.bF)(C,{key:"4",icon:"mdi-logout",color:"error",variant:"elevated",onClick:b.handleLogout,size:"small"},{default:(0,l.k6)(()=>[(0,l.bF)(F,{activator:"parent",location:"left"},{default:(0,l.k6)(()=>[...t[35]||(t[35]=[(0,l.eW)("退出登录",-1)])]),_:1})]),_:1},8,["onClick"])]),_:1})]),(0,l.bF)(D,{justify:"center",align:"center",class:"ma-0 fill-height flex-column z-index-1"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",n,[(0,l.bF)(R,{useConfigLink:!0,class:"d-inline-block mb-4"}),(0,l.Lk)("h1",d,[(0,l.Lk)("a",u,(0,a.v_)(b.ownerName),1),t[36]||(t[36]=(0,l.eW)(" ImgHub ",-1))])]),(0,l.bF)(T,{class:"upload-form-container",selectedUrlForm:v.selectedUrlForm,customerCompress:v.customerCompress,compressQuality:v.compressQuality,compressBar:v.compressBar,serverCompress:v.serverCompress,uploadChannel:v.uploadChannel,channelName:v.channelName,uploadNameType:v.uploadNameType,useCustomUrl:v.useCustomUrl,customUrlPrefix:v.customUrlPrefix,autoRetry:v.autoRetry,urlPrefix:b.urlPrefix,uploadMethod:v.uploadMethod,uploadFolder:v.uploadFolder,convertToWebp:v.convertToWebp},null,8,["selectedUrlForm","customerCompress","compressQuality","compressBar","serverCompress","uploadChannel","channelName","uploadNameType","useCustomUrl","customUrlPrefix","autoRetry","urlPrefix","uploadMethod","uploadFolder","convertToWebp"])]),_:1}),(0,l.bF)(X,{modelValue:v.showUrlDialog,"onUpdate:modelValue":t[10]||(t[10]=e=>v.showUrlDialog=e),"max-width":"600px",transition:"dialog-bottom-transition"},{default:(0,l.k6)(()=>[(0,l.bF)(B,{rounded:"xl"},{default:(0,l.k6)(()=>[(0,l.bF)(N,{color:"surface",density:"compact"},{default:(0,l.k6)(()=>[(0,l.bF)(E,null,{default:(0,l.k6)(()=>[...t[37]||(t[37]=[(0,l.eW)("链接格式设置",-1)])]),_:1}),(0,l.bF)(I),(0,l.bF)(C,{icon:"mdi-close",onClick:t[5]||(t[5]=e=>v.showUrlDialog=!1)})]),_:1}),(0,l.bF)(j,null,{default:(0,l.k6)(()=>[t[39]||(t[39]=(0,l.Lk)("div",{class:"text-subtitle-1 mb-2"},"默认复制链接",-1)),(0,l.bF)(W,{modelValue:v.selectedUrlForm,"onUpdate:modelValue":t[6]||(t[6]=e=>v.selectedUrlForm=e),onChange:b.changeUrlForm,inline:""},{default:(0,l.k6)(()=>[(0,l.bF)(P,{label:"原始链接",value:"url"}),(0,l.bF)(P,{label:"MarkDown",value:"md"}),(0,l.bF)(P,{label:"HTML",value:"html"}),(0,l.bF)(P,{label:"BBCode",value:"ubb"})]),_:1},8,["modelValue","onChange"]),(0,l.bF)(A,{class:"my-4"}),(0,l.Lk)("div",c,[t[38]||(t[38]=(0,l.Lk)("div",{class:"text-subtitle-1"},"自定义链接",-1)),(0,l.bF)(V,{modelValue:v.useCustomUrl,"onUpdate:modelValue":t[7]||(t[7]=e=>v.useCustomUrl=e),color:"primary","hide-details":"",density:"compact","true-value":"true","false-value":"false"},null,8,["modelValue"])]),(0,l.bF)(z,null,{default:(0,l.k6)(()=>["true"===v.useCustomUrl?((0,l.uX)(),(0,l.CE)("div",h,[(0,l.bF)(w,{modelValue:v.customUrlPrefix,"onUpdate:modelValue":t[8]||(t[8]=e=>v.customUrlPrefix=e),label:"自定义前缀",placeholder:"https://your.domain/file/",variant:"outlined",density:"compact"},null,8,["modelValue"])])):(0,l.Q3)("",!0)]),_:1})]),_:1}),(0,l.bF)(H,null,{default:(0,l.k6)(()=>[(0,l.bF)(I),(0,l.bF)(C,{color:"primary",onClick:t[9]||(t[9]=e=>v.showUrlDialog=!1)},{default:(0,l.k6)(()=>[...t[40]||(t[40]=[(0,l.eW)("确定",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,l.bF)(X,{modelValue:v.showCompressDialog,"onUpdate:modelValue":t[21]||(t[21]=e=>v.showCompressDialog=e),"max-width":"800px",scrollable:"",transition:"dialog-bottom-transition"},{default:(0,l.k6)(()=>[(0,l.bF)(B,{rounded:"xl"},{default:(0,l.k6)(()=>[(0,l.bF)(N,{color:"surface",density:"compact"},{default:(0,l.k6)(()=>[(0,l.bF)(E,null,{default:(0,l.k6)(()=>[...t[41]||(t[41]=[(0,l.eW)("上传设置",-1)])]),_:1}),(0,l.bF)(I),(0,l.bF)(C,{icon:"mdi-close",onClick:t[11]||(t[11]=e=>v.showCompressDialog=!1)})]),_:1}),(0,l.bF)(j,{style:{"max-height":"600px"}},{default:(0,l.k6)(()=>[(0,l.bF)(_,{lines:"two",subheader:""},{default:(0,l.k6)(()=>[(0,l.bF)(Q,null,{default:(0,l.k6)(()=>[...t[42]||(t[42]=[(0,l.eW)("上传渠道",-1)])]),_:1}),(0,l.bF)(L,null,{default:(0,l.k6)(()=>[(0,l.bF)(W,{modelValue:v.uploadChannel,"onUpdate:modelValue":t[12]||(t[12]=e=>v.uploadChannel=e),inline:""},{default:(0,l.k6)(()=>[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)([{l:"TG",v:"telegram",i:"mdi-send"},{l:"R2",v:"cfr2",i:"mdi-cloud"},{l:"S3",v:"s3",i:"mdi-database"},{l:"DC",v:"discord",i:"mdi-message"},{l:"HF",v:"huggingface",i:"mdi-robot"}],e=>(0,l.bF)(P,{key:e.v,value:e.v,label:e.l,class:"mr-4"},{label:(0,l.k6)(()=>[(0,l.bF)(y,{start:"",size:"small"},{default:(0,l.k6)(()=>[(0,l.eW)((0,a.v_)(e.i),1)]),_:2},1024),(0,l.eW)((0,a.v_)(e.l),1)]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1}),b.currentChannelList.length>1?((0,l.uX)(),(0,l.Wv)(L,{key:0},{default:(0,l.k6)(()=>[(0,l.bF)(O,{modelValue:v.channelName,"onUpdate:modelValue":t[13]||(t[13]=e=>v.channelName=e),items:b.currentChannelList,"item-title":"name","item-value":"name",label:"渠道名称",clearable:"",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),_:1})):(0,l.Q3)("",!0),(0,l.bF)(L,null,{default:(0,l.k6)(()=>[(0,l.bF)(w,{modelValue:v.uploadFolder,"onUpdate:modelValue":t[14]||(t[14]=e=>v.uploadFolder=e),label:"上传目录",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),(0,l.bF)(L,null,{prepend:(0,l.k6)(()=>[(0,l.bF)(y,{icon:"mdi-refresh"})]),append:(0,l.k6)(()=>[(0,l.bF)(V,{modelValue:v.autoRetry,"onUpdate:modelValue":t[15]||(t[15]=e=>v.autoRetry=e),color:"primary"},null,8,["modelValue"])]),default:(0,l.k6)(()=>[(0,l.bF)(x,null,{default:(0,l.k6)(()=>[...t[43]||(t[43]=[(0,l.eW)("自动切换",-1)])]),_:1}),(0,l.bF)(G,null,{default:(0,l.k6)(()=>[...t[44]||(t[44]=[(0,l.eW)("上传失败自动切换其他渠道",-1)])]),_:1})]),_:1}),(0,l.bF)(A),(0,l.bF)(Q,null,{default:(0,l.k6)(()=>[...t[45]||(t[45]=[(0,l.eW)("客户端预处理",-1)])]),_:1}),(0,l.bF)(L,null,{prepend:(0,l.k6)(()=>[(0,l.bF)(y,null,{default:(0,l.k6)(()=>[...t[46]||(t[46]=[(0,l.eW)("mdi-file-image",-1)])]),_:1})]),append:(0,l.k6)(()=>[(0,l.bF)(V,{modelValue:v.convertToWebp,"onUpdate:modelValue":t[16]||(t[16]=e=>v.convertToWebp=e),color:"primary"},null,8,["modelValue"])]),default:(0,l.k6)(()=>[(0,l.bF)(x,null,{default:(0,l.k6)(()=>[...t[47]||(t[47]=[(0,l.eW)("转换为 WebP",-1)])]),_:1})]),_:1}),(0,l.bF)(L,null,{prepend:(0,l.k6)(()=>[(0,l.bF)(y,null,{default:(0,l.k6)(()=>[...t[48]||(t[48]=[(0,l.eW)("mdi-zip-box",-1)])]),_:1})]),append:(0,l.k6)(()=>[(0,l.bF)(V,{modelValue:v.customerCompress,"onUpdate:modelValue":t[17]||(t[17]=e=>v.customerCompress=e),color:"primary"},null,8,["modelValue"])]),default:(0,l.k6)(()=>[(0,l.bF)(x,null,{default:(0,l.k6)(()=>[...t[49]||(t[49]=[(0,l.eW)("图片压缩",-1)])]),_:1})]),_:1}),(0,l.bF)(z,null,{default:(0,l.k6)(()=>[v.customerCompress?((0,l.uX)(),(0,l.CE)("div",p,[(0,l.Lk)("div",m,"压缩阈值 ("+(0,a.v_)(v.compressBar)+" MB)",1),(0,l.bF)(J,{modelValue:v.compressBar,"onUpdate:modelValue":t[18]||(t[18]=e=>v.compressBar=e),min:1,max:20,step:1,"thumb-label":"",color:"primary"},null,8,["modelValue"]),(0,l.Lk)("div",f,"期望大小 ("+(0,a.v_)(v.compressQuality)+" MB)",1),(0,l.bF)(J,{modelValue:v.compressQuality,"onUpdate:modelValue":t[19]||(t[19]=e=>v.compressQuality=e),min:.5,max:v.compressBar,step:.1,"thumb-label":"",color:"primary"},null,8,["modelValue","max"])])):(0,l.Q3)("",!0)]),_:1})]),_:1})]),_:1}),(0,l.bF)(H,null,{default:(0,l.k6)(()=>[(0,l.bF)(I),(0,l.bF)(C,{color:"primary",onClick:t[20]||(t[20]=e=>v.showCompressDialog=!1)},{default:(0,l.k6)(()=>[...t[50]||(t[50]=[(0,l.eW)("确定",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,l.bF)(X,{modelValue:v.showAnnouncementDialog,"onUpdate:modelValue":t[23]||(t[23]=e=>v.showAnnouncementDialog=e),"max-width":"500"},{default:(0,l.k6)(()=>[(0,l.bF)(B,null,{default:(0,l.k6)(()=>[(0,l.bF)(q,{class:"text-h5"},{default:(0,l.k6)(()=>[...t[51]||(t[51]=[(0,l.eW)("公告",-1)])]),_:1}),(0,l.bF)(j,{innerHTML:v.announcementContent},null,8,["innerHTML"]),(0,l.bF)(H,null,{default:(0,l.k6)(()=>[(0,l.bF)(I),(0,l.bF)(C,{color:"primary",text:"",onClick:t[22]||(t[22]=e=>v.showAnnouncementDialog=!1)},{default:(0,l.k6)(()=>[...t[52]||(t[52]=[(0,l.eW)("我已知晓！",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,l.bF)(K,{show:v.showHistory,onClose:t[24]||(t[24]=e=>v.showHistory=!1)},null,8,["show"]),(0,l.bF)(Y,{class:"footer"})]),_:1})}o(4114),o(8111),o(3579);var v=o(5130);const b={class:"upload-form"},y={class:"upload-card-glow",ref:"uploadCardGlow"},C={class:"paste-card-actions mt-4 d-flex align-center justify-space-between w-100 px-4"},k={class:"modern-action-group d-flex align-center"},w={class:"d-flex align-center"},F=["src"],U={key:0,class:"d-flex flex-column gap-2",style:{width:"100%","max-width":"600px"}},x={class:"d-flex gap-2 mb-1"},L={class:"d-flex gap-2"},_={key:1,class:"w-100 pr-4"},M={class:"text-caption text-right mt-1"},S={class:"d-flex flex-column gap-2 ml-2"};function $(e,t,i,s,r,n){const d=(0,l.g2)("v-icon"),u=(0,l.g2)("v-card"),c=(0,l.g2)("v-textarea"),h=(0,l.g2)("v-btn"),p=(0,l.g2)("v-btn-toggle"),m=(0,l.g2)("v-chip"),f=(0,l.g2)("v-tooltip"),g=(0,l.g2)("v-switch"),$=(0,l.g2)("v-list-item"),R=(0,l.g2)("v-list"),T=(0,l.g2)("v-menu"),D=(0,l.g2)("v-img"),E=(0,l.g2)("v-avatar"),I=(0,l.g2)("v-list-item-title"),N=(0,l.g2)("v-text-field"),P=(0,l.g2)("v-progress-linear");return(0,l.uX)(),(0,l.CE)("div",b,[(0,l.Lk)("div",{class:"upload-card-wrapper",onMousemove:t[4]||(t[4]=(...e)=>n.handleUploadCardMouseMove&&n.handleUploadCardMouseMove(...e)),onMouseleave:t[5]||(t[5]=(...e)=>n.handleUploadCardMouseLeave&&n.handleUploadCardMouseLeave(...e))},[(0,l.Lk)("div",y,null,512),"default"===i.uploadMethod?((0,l.uX)(),(0,l.Wv)(u,{key:0,class:(0,a.C4)(["upload-card d-flex flex-column align-center justify-center",{"is-uploading":r.uploading,"upload-card-busy":r.fileList.length}]),elevation:"10",rounded:"xl",onDragover:(0,v.D$)(n.handleDragOver,["prevent"]),onDragleave:(0,v.D$)(n.handleDragLeave,["prevent"]),onDrop:(0,v.D$)(n.handleDrop,["prevent"]),onClick:n.triggerFileInput},{default:(0,l.k6)(()=>[(0,l.Lk)("div",{class:(0,a.C4)(["d-flex flex-column align-center justify-center upload-drop-zone",{"is-dragover":r.isDragOver}])},[(0,l.bF)(d,{size:r.fileList.length?60:100,color:"primary",class:(0,a.C4)(["mb-4 upload-icon",{"upload-list-busy":r.fileList.length}])},{default:(0,l.k6)(()=>[...t[9]||(t[9]=[(0,l.eW)(" mdi-cloud-upload ",-1)])]),_:1},8,["size","class"]),(0,l.Lk)("div",{class:(0,a.C4)(["text-medium-emphasis text-center upload-text",{"upload-list-busy":r.fileList.length}])},[...t[10]||(t[10]=[(0,l.Lk)("em",null,"拖拽",-1),(0,l.eW)(),(0,l.Lk)("em",null,"点击",-1),(0,l.eW)(" 或 ",-1),(0,l.Lk)("em",null,"Ctrl + V",-1),(0,l.eW)(" 粘贴上传 ",-1)])],2),(0,l.Lk)("input",{type:"file",ref:"fileInput",class:"d-none",multiple:"",onChange:t[0]||(t[0]=(...e)=>n.handleFileSelect&&n.handleFileSelect(...e)),onClick:t[1]||(t[1]=(0,v.D$)(()=>{},["stop"]))},null,544)],2)]),_:1},8,["class","onDragover","onDragleave","onDrop","onClick"])):(0,l.Q3)("",!0),"paste"===i.uploadMethod?((0,l.uX)(),(0,l.Wv)(u,{key:1,class:(0,a.C4)(["paste-card",{"is-uploading":r.uploading,"upload-card-busy":r.fileList.length}]),elevation:"10",rounded:"xl"},{default:(0,l.k6)(()=>[(0,l.bF)(c,{modelValue:r.pastedUrls,"onUpdate:modelValue":t[2]||(t[2]=e=>r.pastedUrls=e),class:"upload-card-textarea",placeholder:"粘贴外链上传，多个外链用换行分隔",rows:r.fileList.length?4:14,variant:"solo-filled","bg-color":"surface","hide-details":"","no-resize":""},null,8,["modelValue","rows"]),(0,l.Lk)("div",C,[(0,l.bF)(h,{color:"primary",size:n.pasteCardMethodButtonSize,onClick:n.handleUploadPasteUrls,class:"paste-card-upload-button font-weight-bold",elevation:"4"},{default:(0,l.k6)(()=>[...t[11]||(t[11]=[(0,l.eW)(" 上 传 ",-1)])]),_:1},8,["size","onClick"]),(0,l.bF)(p,{modelValue:r.pasteUploadMethod,"onUpdate:modelValue":t[3]||(t[3]=e=>r.pasteUploadMethod=e),mandatory:"",rounded:"xl",color:"primary",class:"paste-card-method-group",density:"compact"},{default:(0,l.k6)(()=>[(0,l.bF)(h,{value:"save",size:"small"},{default:(0,l.k6)(()=>[...t[12]||(t[12]=[(0,l.eW)("转存",-1)])]),_:1}),(0,l.bF)(h,{value:"external",size:"small"},{default:(0,l.k6)(()=>[...t[13]||(t[13]=[(0,l.eW)("外链",-1)])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["class"])):(0,l.Q3)("",!0)],32),(0,l.bF)(u,{class:(0,a.C4)(["upload-list-card mt-4 overflow-hidden",{"upload-list-busy":r.fileList.length,"is-uploading":r.uploading}]),elevation:"10",rounded:"xl"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",{class:(0,a.C4)(["upload-list-container d-flex flex-column",{"upload-list-busy":r.fileList.length}])},[(0,l.Lk)("div",{class:(0,a.C4)(["upload-list-dashboard d-flex align-center justify-space-between px-4 py-2",{"list-scrolled":r.listScrolled}])},[(0,l.Lk)("div",{class:"d-flex align-center cursor-pointer status-toggle",onClick:t[6]||(t[6]=(...t)=>e.toggleStatusView&&e.toggleStatusView(...t))},[(0,l.bF)(m,{size:"small",color:"primary",class:"mr-2",variant:"elevated"},{default:(0,l.k6)(()=>[(0,l.bF)(d,{start:"",icon:"mdi-format-list-bulleted"}),(0,l.eW)(" "+(0,a.v_)(n.uploadingCount+n.waitingCount),1)]),_:1}),(0,l.bF)(m,{size:"small",color:"success",class:"mr-2",variant:"elevated"},{default:(0,l.k6)(()=>[(0,l.bF)(d,{start:"",icon:"mdi-check-circle"}),(0,l.eW)(" "+(0,a.v_)(n.uploadSuccessCount),1)]),_:1}),(0,l.bF)(m,{size:"small",color:"error",variant:"elevated"},{default:(0,l.k6)(()=>[(0,l.bF)(d,{start:"",icon:"mdi-alert-circle"}),(0,l.eW)(" "+(0,a.v_)(n.uploadErrorCount),1)]),_:1})]),(0,l.Lk)("div",k,[(0,l.bF)(f,{location:"top",text:"整体复制"},{activator:(0,l.k6)(({props:e})=>[(0,l.bF)(h,(0,l.v6)({icon:"mdi-content-copy",variant:"text",size:"small",color:"primary"},e,{onClick:n.copyAll}),null,16,["onClick"])]),_:1}),(0,l.bF)(T,null,{activator:(0,l.k6)(({props:e})=>[(0,l.bF)(h,(0,l.v6)({icon:"mdi-reload",variant:"text",size:"small",color:"primary"},e,{onClick:n.retryError}),{default:(0,l.k6)(()=>[(0,l.bF)(f,{activator:"parent",location:"top"},{default:(0,l.k6)(()=>[...t[14]||(t[14]=[(0,l.eW)("失败重试",-1)])]),_:1})]),_:1},16,["onClick"])]),default:(0,l.k6)(()=>[(0,l.bF)(R,{density:"compact"},{default:(0,l.k6)(()=>[(0,l.bF)($,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",w,[t[15]||(t[15]=(0,l.Lk)("span",{class:"text-caption mr-2"},"自动重试",-1)),(0,l.bF)(g,{modelValue:r.autoReUpload,"onUpdate:modelValue":t[7]||(t[7]=e=>r.autoReUpload=e),onChange:n.handleAutoRetryChange,"hide-details":"",density:"compact",color:"primary"},null,8,["modelValue","onChange"])])]),_:1})]),_:1})]),_:1}),(0,l.bF)(T,null,{activator:(0,l.k6)(({props:e})=>[(0,l.bF)(h,(0,l.v6)({icon:"mdi-delete",variant:"text",size:"small",color:"error"},e),{default:(0,l.k6)(()=>[(0,l.bF)(f,{activator:"parent",location:"top"},{default:(0,l.k6)(()=>[...t[16]||(t[16]=[(0,l.eW)("清空列表",-1)])]),_:1})]),_:1},16)]),default:(0,l.k6)(()=>[(0,l.bF)(R,{density:"compact"},{default:(0,l.k6)(()=>[(0,l.bF)($,{onClick:n.clearFileList,title:"清空全部"},null,8,["onClick"]),(0,l.bF)($,{onClick:n.clearSuccessList,title:"清空已上传"},null,8,["onClick"])]),_:1})]),_:1})])],2),(0,l.Lk)("div",{class:"flex-grow-1 overflow-y-auto",ref:"scrollContainer",onScroll:t[8]||(t[8]=(...e)=>n.handleScroll&&n.handleScroll(...e))},[(0,l.bF)(R,{"bg-color":"transparent",class:"pa-0"},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.displayedFileList,e=>((0,l.uX)(),(0,l.Wv)($,{key:e.uid,class:"mb-2 px-4"},{prepend:(0,l.k6)(()=>[(0,l.bF)(E,{rounded:"lg",size:"60",class:"mr-4"},{default:(0,l.k6)(()=>[n.isImage(e.name)?((0,l.uX)(),(0,l.Wv)(D,{key:0,src:e.url,cover:"",onError:t=>e.url=o(6682)},null,8,["src","onError"])):n.isVideo(e.name)?((0,l.uX)(),(0,l.CE)("video",{key:1,src:e.url,style:{width:"100%",height:"100%","object-fit":"cover"},autoplay:"",muted:"",playsinline:"",loop:""},null,8,F)):((0,l.uX)(),(0,l.Wv)(d,{key:2,icon:"mdi-file",size:"large",color:"medium-emphasis"}))]),_:2},1024)]),append:(0,l.k6)(()=>[(0,l.Lk)("div",S,[(0,l.bF)(h,{icon:"mdi-link",variant:"tonal",size:"small",color:"primary",onClick:t=>n.handleCopy(e),disabled:"done"!==e.status&&"success"!==e.status},null,8,["onClick","disabled"]),(0,l.bF)(h,{icon:"mdi-delete",variant:"tonal",size:"small",color:"error",onClick:t=>n.handleRemove(e)},null,8,["onClick"])])]),default:(0,l.k6)(()=>[(0,l.bF)(I,{class:"font-weight-medium mb-1"},{default:(0,l.k6)(()=>[(0,l.eW)((0,a.v_)(n.truncateFilename(e.name)),1)]),_:2},1024),"done"===e.status||"success"===e.status?((0,l.uX)(),(0,l.CE)("div",U,[(0,l.Lk)("div",x,[(0,l.bF)(N,{modelValue:e.finalURL,"onUpdate:modelValue":t=>e.finalURL=t,readonly:"",variant:"outlined",density:"compact","hide-details":"","bg-color":"surface",onClick:n.selectAllText,label:"URL",class:"flex-grow-1"},null,8,["modelValue","onUpdate:modelValue","onClick"]),(0,l.bF)(N,{modelValue:e.mdURL,"onUpdate:modelValue":t=>e.mdURL=t,readonly:"",variant:"outlined",density:"compact","hide-details":"","bg-color":"surface",onClick:n.selectAllText,label:"Markdown",class:"flex-grow-1"},null,8,["modelValue","onUpdate:modelValue","onClick"])]),(0,l.Lk)("div",L,[(0,l.bF)(N,{modelValue:e.htmlURL,"onUpdate:modelValue":t=>e.htmlURL=t,readonly:"",variant:"outlined",density:"compact","hide-details":"","bg-color":"surface",onClick:n.selectAllText,label:"HTML",class:"flex-grow-1"},null,8,["modelValue","onUpdate:modelValue","onClick"]),(0,l.bF)(N,{modelValue:e.ubbURL,"onUpdate:modelValue":t=>e.ubbURL=t,readonly:"",variant:"outlined",density:"compact","hide-details":"","bg-color":"surface",onClick:n.selectAllText,label:"BBCode",class:"flex-grow-1"},null,8,["modelValue","onUpdate:modelValue","onClick"])])])):((0,l.uX)(),(0,l.CE)("div",_,[(0,l.bF)(P,{"model-value":e.progreess,color:"exception"===e.status?"error":"primary",height:"8",rounded:"",striped:""},null,8,["model-value","color"]),(0,l.Lk)("div",M,(0,a.v_)(e.progreess)+"%",1)]))]),_:2},1024))),128))]),_:1})],544)],2)]),_:1},8,["class"])])}o(6573),o(8100),o(7936),o(2489),o(116),o(7588),o(1701),o(8237),o(3110),o(7642),o(8004),o(3853),o(5876),o(2475),o(5024),o(1698),o(9577),o(8335),o(1549),o(9797),o(9631),o(5623),o(4979),o(4603),o(7566),o(8721);var R=o(635),T=o(6334),D=o(782),E={name:"UploadForm",props:{selectedUrlForm:{type:String,default:"url"},customerCompress:{type:Boolean,default:!0},compressQuality:{type:Number,default:4},compressBar:{type:Number,default:5},serverCompress:{type:Boolean,default:!0},uploadChannel:{type:String,default:"telegram"},channelName:{type:String,default:""},uploadNameType:{type:String,default:"default"},useCustomUrl:{type:String,default:"false"},customUrlPrefix:{type:String,default:""},autoRetry:{type:Boolean,default:!0},urlPrefix:{type:String,default:""},uploadMethod:{type:String,default:"default"},uploadFolder:{type:String,default:""},convertToWebp:{type:Boolean,default:!1}},data(){return{fileList:[],uploading:!1,maxUploading:6,exceptionList:[],listScrolled:!1,uploadCount:0,pastedUrls:"",pasteUploadMethod:"save",autoReUpload:!0,maxRetryCount:10,retryTimer:null,retryDelay:12e3,uploadQueue:[],activeUploads:0,maxConcurrentUploads:6,abortControllers:new Map,isDragOver:!1}},computed:{...(0,D.L8)(["storeAutoReUpload"]),uploadSuccessCount(){return this.fileList.filter(e=>"done"===e.status||"success"===e.status).length},uploadErrorCount(){return this.fileList.filter(e=>"exception"===e.status).length},uploadingCount(){return this.fileList.filter(e=>"uploading"===e.status).length},waitingCount(){return this.uploadQueue.length},urlSize(){return window.innerWidth<768?"compact":"default"},rootUrl(){return"true"===this.useCustomUrl?this.customUrlPrefix:this.urlPrefix||`${window.location.protocol}//${window.location.host}/file/`},pasteCardMethodButtonSize(){return this.fileList.length||window.innerWidth<768?"small":"large"},displayedFileList(){return this.fileList.slice().reverse()}},watch:{fileList:{handler(){this.fileList.length>0&&this.$nextTick(()=>{})},deep:!0},useCustomUrl:{handler(){this.updateFileUrls()},immediate:!0},customUrlPrefix:{handler(){this.updateFileUrls()},immediate:!0},autoReUpload(e){this.$store.commit("setStoreAutoReUpload",e)}},mounted(){document.addEventListener("paste",this.handlePaste),this.autoReUpload=this.storeAutoReUpload},beforeUnmount(){document.removeEventListener("paste",this.handlePaste),this.uploadQueue=[],this.fileList=[],this.activeUploads=0,this.retryTimer&&clearTimeout(this.retryTimer)},methods:{updateFileUrls(){this.fileList.forEach(e=>{if("external"===e.uploadChannel)return;const t="true"===this.useCustomUrl?this.customUrlPrefix:this.rootUrl;e.srcID&&(e.finalURL=t+e.srcID,e.mdURL=`![${e.name}](${t+e.srcID})`,e.htmlURL=`<img src="${t+e.srcID}" alt="${e.name}" width=100% />`,e.ubbURL=`[img]${t+e.srcID}[/img]`)})},truncateFilename(e,t=20){if(!e||e.length<=t)return e;const o=e.lastIndexOf("."),l=o>0?e.substring(0,o):e,a=o>0?e.substring(o):"",i=a.length+4,s=t-i-3;return s<=0?e.substring(0,t-3)+"...":l.substring(0,s)+"..."+l.slice(-4)+a},triggerFileInput(){this.$refs.fileInput.click()},handleFileSelect(e){const t=Array.from(e.target.files);t.forEach(e=>{e.uid=Date.now()+Math.random(),this.beforeUpload(e).then(e=>{this.uploadFile({file:e,onSuccess:this.handleSuccess,onError:this.handleError,onProgress:this.handleProgress})}).catch(e=>console.error(e))}),e.target.value=""},handleDragOver(e){this.isDragOver=!0},handleDragLeave(e){this.isDragOver=!1},handleDrop(e){this.isDragOver=!1;const t=Array.from(e.dataTransfer.files);t.forEach(e=>{e.uid=Date.now()+Math.random(),this.beforeUpload(e).then(e=>{this.uploadFile({file:e,onSuccess:this.handleSuccess,onError:this.handleError,onProgress:this.handleProgress})}).catch(e=>console.error(e))})},uploadFile(e){const{file:t}=e;if(!this.fileList.find(e=>e.uid===t.uid))return;if(this.activeUploads>=this.maxConcurrentUploads){this.uploadQueue.push(e);const o=this.fileList.find(e=>e.uid===t.uid);return void(o&&(o.status="waiting"))}this.activeUploads++;const o=this.fileList.find(e=>e.uid===t.uid);o&&(o.status="uploading");const l=this.fileList.find(e=>e.uid===t.uid),a=l?.uploadChannel||this.uploadChannel;if("external"===a)return void this.uploadSingleFile(e);const i=20971520;if("huggingface"===a&&t.size>=i)return void this.uploadToHuggingFaceDirect(e);const s=9437184;if("discord"===a)return void(t.size>s?this.uploadFileInChunks(e):this.uploadSingleFile(e));const r=20971520;t.size>r?this.uploadFileInChunks(e):this.uploadSingleFile(e)},processUploadQueue(){if(0===this.uploadQueue.length||this.activeUploads>=this.maxConcurrentUploads)return;const e=this.uploadQueue.shift();e&&this.fileList.find(t=>t.uid===e.file.uid)?this.uploadFile(e):this.processUploadQueue()},onUploadComplete(){this.activeUploads=Math.max(0,this.activeUploads-1),this.processUploadQueue(),0===this.activeUploads&&0===this.uploadQueue.length&&(this.uploading=!1)},async uploadSingleFile(e){const{file:t}=e,o=this.fileList.find(e=>e.uid===t.uid);if(!o)return;const l=o.serverCompress,a=o.uploadChannel||this.uploadChannel,i=this.autoRetry&&"external"!==a,s="external"===a?"default":this.uploadNameType,r=new AbortController;this.abortControllers.set(t.uid,r);const n=new FormData;if(n.append("file",t),"external"===a&&n.append("url",t.url),"huggingface"===a)try{const e=await this.computeSha256(t);n.append("sha256",e)}catch(d){console.error("Failed to compute SHA256",d)}(0,R.A)({url:`/upload?serverCompress=${l}&uploadChannel=${a}`+(this.channelName?`&channelName=${encodeURIComponent(this.channelName)}`:"")+`&uploadNameType=${s}&autoRetry=${i}&uploadFolder=${this.uploadFolder}`,method:"post",data:n,withAuthCode:!0,signal:r.signal,onUploadProgress:e=>{const o=Math.round(e.loaded/e.total*100);this.handleProgress({percent:o,file:t})}}).then(e=>{this.handleSuccess(e,t)}).catch(e=>{"CanceledError"!==e.name&&"ERR_CANCELED"!==e.code&&(e.response&&401!==e.response.status?(this.exceptionList.push({file:t,retryCount:o.retryCount}),this.handleError(e,t)):e.response||(this.exceptionList.push({file:t,retryCount:o.retryCount}),this.handleError(e,t)))}).finally(()=>{this.abortControllers.delete(t.uid),this.onUploadComplete()})},handleUploadCardMouseMove(e){const t=this.$refs.uploadCardGlow;if(!t)return;if(!e.currentTarget)return;const o=e.currentTarget.getBoundingClientRect(),l=e.clientX-o.left,a=e.clientY-o.top;t.style.opacity="1",t.style.left=l+"px",t.style.top=a+"px"},handleUploadCardMouseLeave(){const e=this.$refs.uploadCardGlow;e&&(e.style.opacity="0")},saveToHistory(e){try{const t=JSON.parse(localStorage.getItem("uploadHistory")||"[]"),o={name:e.name,url:e.finalURL,time:Date.now(),type:e.name.split(".").pop().toLowerCase()};t.push(o),localStorage.setItem("uploadHistory",JSON.stringify(t))}catch(t){console.error("Failed to save history",t)}},copyAll(){const e={url:"finalURL",md:"mdURL",html:"htmlURL",ubb:"ubbURL"},t=e[this.selectedUrlForm]||"finalURL",o=this.fileList.filter(e=>"done"===e.status||"success"===e.status).map(e=>e[t]).join("\n");o?(navigator.clipboard.writeText(o),this.$message.success("整体复制成功")):this.$message.info("没有可复制的链接")},clearFileList(){this.fileList.length>0&&(this.abortControllers.forEach(e=>e.abort()),this.abortControllers.clear(),this.uploadQueue=[],this.fileList=[],this.$message.success("文件列表已清空"))},clearSuccessList(){this.uploadSuccessCount>0&&(this.fileList=this.fileList.filter(e=>"done"!==e.status&&"success"!==e.status),this.$message.success("成功上传文件已清空"))},handleRemove(e){this.abortControllers.has(e.uid)&&(this.abortControllers.get(e.uid).abort(),this.abortControllers.delete(e.uid)),this.uploadQueue=this.uploadQueue.filter(t=>t.file.uid!==e.uid),this.fileList=this.fileList.filter(t=>t.uid!==e.uid),this.$message.info(`${this.truncateFilename(e.name)} 已删除`)},handleCopy(e){if("done"!==e.status&&"success"!==e.status)return;const t={url:"finalURL",md:"mdURL",html:"htmlURL",ubb:"ubbURL"},o=t[this.selectedUrlForm]||"finalURL";navigator.clipboard.writeText(e[o]),this.$message.success("复制成功")},selectAllText(e){e.target.select(),navigator.clipboard.writeText(e.target.value).then(()=>this.$message.success("复制成功")).catch(()=>this.$message.error("复制失败"))},isImage(e){const t=["jpg","jpeg","png","gif","bmp","webp","svg","tiff","ico","avif","heic"];return t.includes(e.split(".").pop().toLowerCase())},isVideo(e){const t=["mp4","webm","ogg","mkv"];return t.includes(e.split(".").pop().toLowerCase())},handleScroll(e){},retryError(){this.exceptionList.length>0?(this.retryFailedFiles(this.exceptionList),this.exceptionList=[]):this.$message.info("无上传失败文件")},handleAutoRetryChange(e){this.$message({type:e?"success":"info",message:e?"自动重试已开启":"自动重试已关闭"}),e&&this.exceptionList.length>0&&this.scheduleAutoRetry()},scheduleAutoRetry(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=setTimeout(()=>{if(this.autoReUpload&&this.exceptionList.length>0){const e=[...this.exceptionList];this.exceptionList=[],this.retryFailedFiles(e)}},this.retryDelay)},retryFailedFiles(e){e.forEach(e=>{const t=e.retryCount||0;if(t<this.maxRetryCount){const o=this.fileList.find(t=>t.uid===e.file.uid);o&&(o.retryCount=t+1,o.status="uploading",this.uploadFile({file:e.file,onProgress:e=>this.handleProgress(e),onSuccess:(e,t)=>this.handleSuccess(e,t),onError:(e,t)=>this.handleError(e,t)}))}else this.$message.warning(`${e.file.name} 已达到最大重试次数`)})},handlePaste(e){if("INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName)return;const t=e.clipboardData.items;t.length>0&&this.uploadFromUrl(t)},handleUploadPasteUrls(){const e=this.pastedUrls.split("\n").map(e=>e.trim()).filter(e=>""!==e&&/^(https?:\/\/[^\s$.?#].[^\s]*)$/.test(e));"save"===this.pasteUploadMethod?this.uploadFromUrl(e.map(e=>({kind:"string",getAsString:t=>t(e)}))):e.forEach((e,t)=>{const o=e.split("/").pop()||`file_${Date.now()}`,l=new File([],o,{type:"text/plain"});l.uid=Date.now()+t,l.url=e,this.fileList.push({uid:l.uid,name:l.name,url:e,finalURL:e,mdURL:`![${o}](${e})`,htmlURL:`<img src="${e}" alt="${o}" width=100% />`,ubbURL:`[img]${e}[/img]`,srcID:e,status:"uploading",progreess:0,serverCompress:!1,uploadChannel:"external",retryCount:0}),this.uploadFile({file:l,onSuccess:this.handleSuccess,onError:this.handleError,onProgress:this.handleProgress})})},uploadFromUrl(e){for(let t=0;t<e.length;t++)if("file"===e[t].kind){const o=e[t].getAsFile();o&&(o.uid=Date.now()+t,this.beforeUpload(o).then(e=>{this.uploadFile({file:e,onSuccess:this.handleSuccess,onError:this.handleError,onProgress:this.handleProgress})}))}else"string"===e[t].kind&&e[t].getAsString(e=>{/^(https?:\/\/[^\s$.?#].[^\s]*)$/.test(e)&&R.A.post("/api/fetchRes",{url:e},{responseType:"blob"}).then(o=>{if(200===o.status){let l="";const a=o.headers["content-disposition"];if(a){const e=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(a);e&&e[1]&&(l=e[1].replace(/['"]/g,""))}l||(l=e.split("/").pop()||`pasted_${Date.now()}.bin`);const i=o.data,s=new File([i],l,{type:i.type});s.uid=Date.now()+t,this.beforeUpload(s).then(e=>{this.uploadFile({file:e,onSuccess:this.handleSuccess,onError:this.handleError,onProgress:this.handleProgress})})}}).catch(()=>this.$message.warning("无法获取URL资源"))})},async convertImageToWebp(e){return new Promise((t,o)=>{if(e.type.match(/(gif|svg|webp)/))return void t(null);const l=new Image,a=document.createElement("canvas"),i=a.getContext("2d");l.onload=()=>{a.width=l.width,a.height=l.height,i.drawImage(l,0,0),a.toBlob(a=>{if(a){const o=e.name.replace(/\.[^/.]+$/,"")+".webp",l=new File([a],o,{type:"image/webp"});l.uid=e.uid,t(l)}else o(new Error("WebP Conversion failed"));URL.revokeObjectURL(l.src)},"image/webp",.92)},l.onerror=()=>{URL.revokeObjectURL(l.src),o(new Error("Image load failed"))},l.src=URL.createObjectURL(e)})},createSha256(){const e=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298].map(e=>e>>>0),t=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225].map(e=>e>>>0);let o=[...t],l=new Uint8Array(64),a=0,i=0;const s=(e,t)=>e>>>t|e<<32-t,r=t=>{const l=new Uint32Array(64);for(let e=0;e<16;e++)l[e]=t[4*e]<<24|t[4*e+1]<<16|t[4*e+2]<<8|t[4*e+3];for(let e=16;e<64;e++){const t=s(l[e-15],7)^s(l[e-15],18)^l[e-15]>>>3,o=s(l[e-2],17)^s(l[e-2],19)^l[e-2]>>>10;l[e]=l[e-16]+t+l[e-7]+o>>>0}let[a,i,r,n,d,u,c,h]=o;for(let o=0;o<64;o++){const t=s(d,6)^s(d,11)^s(d,25),p=d&u^~d&c,m=h+t+p+e[o]+l[o]>>>0,f=s(a,2)^s(a,13)^s(a,22),g=a&i^a&r^i&r,v=f+g>>>0;h=c,c=u,u=d,d=n+m>>>0,n=r,r=i,i=a,a=m+v>>>0}o[0]=o[0]+a>>>0,o[1]=o[1]+i>>>0,o[2]=o[2]+r>>>0,o[3]=o[3]+n>>>0,o[4]=o[4]+d>>>0,o[5]=o[5]+u>>>0,o[6]=o[6]+c>>>0,o[7]=o[7]+h>>>0};return{update(e){i+=e.length;let t=0;if(a>0){const o=64-a,i=Math.min(o,e.length);l.set(e.subarray(0,i),a),a+=i,t=i,64===a&&(r(l),a=0)}while(t+64<=e.length)r(e.subarray(t,t+64)),t+=64;t<e.length&&(l.set(e.subarray(t),0),a=e.length-t)},digest(){const e=8*i;l[a++]=128,a>56&&(l.fill(0,a,64),r(l),a=0),l.fill(0,a,56);const t=new DataView(l.buffer);return t.setUint32(56,Math.floor(e/4294967296),!1),t.setUint32(60,e>>>0,!1),r(l),Array.from(o).map(e=>e.toString(16).padStart(8,"0")).join("")}}},async computeSha256(e){const t=this.createSha256(),o=4194304;let l=0;while(l<e.size){const a=e.slice(l,Math.min(l+o,e.size)),i=await a.arrayBuffer();t.update(new Uint8Array(i)),l+=o}return t.digest()},async uploadFileInChunks(e){const{file:t}=e,o=this.fileList.find(e=>e.uid===t.uid);if(!o)return;const l=o.uploadChannel||this.uploadChannel,a=new AbortController;this.abortControllers.set(t.uid,a);const i="discord"===l?9437184:16777216,s=Math.ceil(t.size/i);let r=null;if("huggingface"===l)try{r=await this.computeSha256(t)}catch(n){}try{const e=new FormData;e.append("originalFileName",t.name),e.append("originalFileType",t.type),e.append("totalChunks",s);const d=await(0,R.A)({url:`/upload?serverCompress=${o.serverCompress}&uploadChannel=${l}`+(this.channelName?`&channelName=${encodeURIComponent(this.channelName)}`:"")+`&uploadNameType=${this.uploadNameType}&autoRetry=${this.autoRetry}&uploadFolder=${this.uploadFolder}&initChunked=true`,method:"post",data:e,withAuthCode:!0});if(!d.data.success)throw new Error(d.data.message);const u=d.data.uploadId;o.totalChunks=s,o.uploadId=u;const c=new Array(s).fill(0);let h=!1,p=!1;const m=3,f=Array.from({length:s},(e,t)=>t),g=new Set,v=async e=>{if(h||p)return;const r=e*i,d=Math.min(r+i,t.size),m=t.slice(r,d),f=new FormData;f.append("file",m,`${t.name}.part${String(e).padStart(3,"0")}`),f.append("chunkIndex",e),f.append("totalChunks",s),f.append("uploadId",u),f.append("originalFileName",t.name);let g=3;while(g>0){if(h||p)return;try{return void await(0,R.A)({url:`/upload?serverCompress=${o.serverCompress}&uploadChannel=${l}`+(this.channelName?`&channelName=${encodeURIComponent(this.channelName)}`:"")+`&uploadNameType=${this.uploadNameType}&autoRetry=${this.autoRetry}&uploadFolder=${this.uploadFolder}&chunked=true`,method:"post",data:f,withAuthCode:!0,signal:a.signal,onUploadProgress:o=>{c[e]=Math.round(o.loaded/o.total*100);const l=Math.round(c.reduce((e,t)=>e+t,0)/s);this.handleProgress({percent:l,file:t})}})}catch(n){if("CanceledError"===n.name)return void(p=!0);if(g--,0===g)throw n;await new Promise(e=>setTimeout(e,1e3))}}};while(f.length>0&&!h&&!p){while(g.size<m&&f.length>0){const e=v(f.shift()).then(()=>g.delete(e)).catch(t=>{h=!0,g.delete(e)});g.add(e)}await Promise.race(g)}if(await Promise.all(g),p)return;if(h)throw new Error("Chunk upload failed");const b=new FormData;b.append("uploadId",u),b.append("totalChunks",s),b.append("originalFileName",t.name),r&&b.append("sha256",r);const y=await(0,R.A)({url:`/upload?serverCompress=${o.serverCompress}&uploadChannel=${l}`+(this.channelName?`&channelName=${encodeURIComponent(this.channelName)}`:"")+`&uploadNameType=${this.uploadNameType}&autoRetry=${this.autoRetry}&uploadFolder=${this.uploadFolder}&chunked=true&merge=true`,method:"post",data:b,withAuthCode:!0});this.handleSuccess(y,t)}catch(n){if("CanceledError"===n.name)return;this.autoReUpload&&this.exceptionList.push({file:t,retryCount:o.retryCount}),this.handleError(n,t),o.uploadId&&this.cleanupUploadResources(o.uploadId,o.totalChunks)}finally{this.abortControllers.delete(t.uid),this.onUploadComplete()}},cleanupUploadResources(e,t){R.A.get(`/upload?cleanup=true&uploadId=${e}&totalChunks=${t}`)},async uploadToHuggingFaceDirect(e){const{file:t}=e,o=this.fileList.find(e=>e.uid===t.uid);if(!o)return;const l=new AbortController;this.abortControllers.set(t.uid,l);try{const e=await this.computeSha256(t),o=new Uint8Array(await t.slice(0,512).arrayBuffer()),a=btoa(String.fromCharCode(...o)),i=await(0,R.A)({url:"/api/huggingface/getUploadUrl",method:"post",data:{fileSize:t.size,fileName:t.name,fileType:t.type,sha256:e,fileSample:a,channelName:this.channelName,uploadNameType:this.uploadNameType,uploadFolder:this.uploadFolder},withAuthCode:!0,signal:l.signal});if(!i.data.success)throw new Error(i.data.error);const s=i.data;if(!s.alreadyExists&&s.needsLfs&&s.uploadAction){const{href:e,header:o}=s.uploadAction;o?.chunk_size?await this.uploadToHuggingFaceMultipart(t,s,l):await fetch(e,{method:"PUT",headers:o||{},body:t,signal:l.signal})}const r=await(0,R.A)({url:"/api/huggingface/commitUpload",method:"post",data:{fullId:s.fullId,filePath:s.filePath,sha256:e,fileSize:t.size,fileName:t.name,fileType:t.type,channelName:s.channelName},withAuthCode:!0,signal:l.signal});if(!r.data.success)throw new Error(r.data.error);this.handleSuccess({data:[{src:r.data.src}]},t)}catch(a){if("CanceledError"===a.name||"AbortError"===a.name)return;this.autoReUpload&&this.exceptionList.push({file:t,retryCount:o.retryCount}),this.handleError(a,t)}finally{this.abortControllers.delete(t.uid),this.onUploadComplete()}},async uploadToHuggingFaceMultipart(e,t,o){const{href:l,header:a}=t.uploadAction,i=parseInt(a.chunk_size),s=Object.keys(a).filter(e=>/^[0-9]+$/.test(e)),r=[];for(const d of s){if(o.signal.aborted)throw new Error("Canceled");const t=parseInt(d)-1,l=t*i,n=Math.min(l+i,e.size),u=e.slice(l,n),c=await fetch(a[d],{method:"PUT",body:u,signal:o.signal});if(!c.ok)throw new Error("Part upload failed");const h=c.headers.get("ETag");r.push({partNumber:parseInt(d),etag:h});const p=10+Math.round(parseInt(d)/s.length*80);this.handleProgress({percent:p,file:e})}const n=await fetch(l,{method:"POST",headers:{Accept:"application/vnd.git-lfs+json","Content-Type":"application/vnd.git-lfs+json"},body:JSON.stringify({oid:t.oid,parts:r}),signal:o.signal});if(!n.ok)throw new Error("Multipart complete failed")},handleProgress(e){const t=this.fileList.find(t=>t.uid===e.file.uid);t&&(t.progreess=e.percent)},handleSuccess(e,t){const o=this.fileList.find(e=>e.uid===t.uid);if(o)try{const l=o.uploadChannel||this.uploadChannel;if("external"!==l){const l=e.data[0].src.replace("/file/",""),a="true"===this.useCustomUrl?this.customUrlPrefix:this.rootUrl;o.url=`${window.location.protocol}//${window.location.host}/file/`+l,o.finalURL=a+l,o.mdURL=`![${t.name}](${a+l})`,o.htmlURL=`<img src="${a+l}" alt="${t.name}" width=100% />`,o.ubbURL=`[img]${a+l}[/img]`,o.srcID=l}o.progreess=100,o.status="success",this.saveToHistory(o),this.$message.success(`${this.truncateFilename(t.name)} 上传成功`),setTimeout(()=>{const e=this.fileList.find(e=>e.uid===t.uid);e&&(e.status="done")},1e3)}catch(l){this.$message.error("上传成功但解析响应失败"),o.status="exception"}},handleError(e,t){const o=this.fileList.find(e=>e.uid===t.uid);o&&(this.$message.error(`${this.truncateFilename(t.name)} 上传失败`),o.status="exception",this.autoReUpload&&this.scheduleAutoRetry())},beforeUpload(e){return new Promise(async(t,o)=>{let l=e;const a=this.convertToWebp&&e.type.includes("image")&&!e.type.includes("webp")&&!e.type.includes("gif")&&!e.type.includes("svg");if(a)try{const t=await this.convertImageToWebp(e);t&&(l=t)}catch(n){}const i=l.type.includes("image")&&this.customerCompress&&l.size/1024/1024>this.compressBar,s=l.size/1024/1024<=1024||"telegram"!==this.uploadChannel,r=(e,o)=>{const l=URL.createObjectURL(e);this.fileList.push({uid:e.uid,name:e.name,url:l,finalURL:"",mdURL:"",htmlURL:"",ubbURL:"",srcID:"",status:"uploading",progreess:0,serverCompress:o,retryCount:0,uploadChannel:this.uploadChannel}),t(e)};if(i)T.compressAccurately(l,1024*this.compressQuality).then(t=>{if(t.size/1024/1024>1024&&"telegram"===this.uploadChannel)return this.$message.error("文件过大"),void o("File too large");const a=new File([t],l.name,{type:t.type});a.uid=e.uid;const i=this.uploadCount++,s=this.serverCompress&&a.size/1024/1024<10&&"telegram"===this.uploadChannel;0===i?r(a,s):setTimeout(()=>{r(a,s),this.uploadCount--},300*i)}).catch(o);else if(s){const e=this.uploadCount++,t="telegram"===this.uploadChannel&&this.serverCompress&&(!l.type.includes("image")||l.size/1024/1024<10);0===e?r(l,t):setTimeout(()=>{r(l,t),this.uploadCount--},300*e)}else this.$message.error("文件过大"),o("File too large")})}}},I=o(1241);const N=(0,I.A)(E,[["render",$],["__scopeId","data-v-d87b326a"]]);var P=N,W=o(2922),A=o(4417),V=o(9237);const z={class:"history-header d-flex align-center justify-space-between px-6 py-4"},j={class:"header-left d-flex align-baseline"},H={class:"text-caption text-medium-emphasis"},B={class:"header-right d-flex gap-2"},X={class:"timeline-header d-flex align-center mb-4 relative"},Q={class:"text-h6 font-weight-bold gradient-text"},O={key:0,class:"grid-view"},G={class:"grid-preview relative"},J={class:"d-flex align-center justify-center fill-height bg-grey-lighten-2"},q=["src"],K={key:2,class:"d-flex align-center justify-center fill-height bg-grey-lighten-4",style:{height:"160px"}},Y={class:"grid-overlay d-flex align-center justify-center"},Z={class:"d-flex gap-2"},ee={class:"pa-3"},te=["title"],oe={class:"text-caption text-medium-emphasis"},le={key:1,class:"list-view d-flex flex-column gap-3"},ae=["src"],ie={class:"flex-grow-1 min-width-0 mr-4"},se={class:"text-subtitle-2 font-weight-bold text-truncate"},re={class:"text-caption text-medium-emphasis text-truncate"},ne={class:"text-caption text-medium-emphasis mr-4 hidden-xs-only",style:{"min-width":"140px","text-align":"right"}},de={class:"d-flex gap-2"},ue={key:0,class:"d-flex justify-center pa-4"},ce={key:0,class:"d-flex align-center text-medium-emphasis"},he={key:1,class:"text-caption text-medium-emphasis"},pe={key:1,class:"text-center pa-4 text-caption text-medium-emphasis"},me={key:1,class:"d-flex flex-column align-center justify-center flex-grow-1 text-medium-emphasis"};function fe(e,t,o,i,s,r){const n=(0,l.g2)("v-tooltip"),d=(0,l.g2)("v-icon"),u=(0,l.g2)("v-btn"),c=(0,l.g2)("v-img"),h=(0,l.g2)("v-card"),p=(0,l.g2)("v-col"),m=(0,l.g2)("v-row"),f=(0,l.g2)("v-avatar"),g=(0,l.g2)("v-progress-circular");return(0,l.uX)(),(0,l.CE)("div",{class:(0,a.C4)(["history-container",{active:o.show}])},[(0,l.Lk)("div",z,[(0,l.Lk)("div",j,[t[2]||(t[2]=(0,l.Lk)("h2",{class:"text-h5 font-weight-bold gradient-text mr-4"},"历史记录",-1)),(0,l.Lk)("span",H,"共 "+(0,a.v_)(s.totalCount)+" 条",1)]),(0,l.Lk)("div",B,[(0,l.bF)(u,{icon:"",variant:"elevated",density:"comfortable",onClick:r.toggleViewMode,class:"glass-btn"},{default:(0,l.k6)(()=>[(0,l.bF)(n,{activator:"parent",location:"bottom"},{default:(0,l.k6)(()=>[...t[3]||(t[3]=[(0,l.eW)("切换视图",-1)])]),_:1}),(0,l.bF)(d,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,a.v_)("grid"===s.viewMode?"mdi-view-list":"mdi-view-grid"),1)]),_:1})]),_:1},8,["onClick"]),(0,l.bF)(u,{icon:"",variant:"elevated",density:"comfortable",color:"error",onClick:r.clearHistory,class:"glass-btn"},{default:(0,l.k6)(()=>[(0,l.bF)(n,{activator:"parent",location:"bottom"},{default:(0,l.k6)(()=>[...t[4]||(t[4]=[(0,l.eW)("清空记录",-1)])]),_:1}),(0,l.bF)(d,null,{default:(0,l.k6)(()=>[...t[5]||(t[5]=[(0,l.eW)("mdi-delete-sweep",-1)])]),_:1})]),_:1},8,["onClick"]),(0,l.bF)(u,{icon:"",variant:"elevated",density:"comfortable",onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"glass-btn"},{default:(0,l.k6)(()=>[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[...t[6]||(t[6]=[(0,l.eW)("mdi-close",-1)])]),_:1})]),_:1})])]),s.historyList.length>0?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"history-content flex-grow-1 overflow-y-auto px-6 py-4",ref:"historyContent",onScroll:t[1]||(t[1]=(...e)=>r.handleScroll&&r.handleScroll(...e))},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.groupedHistory,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.date,class:"history-group mb-6"},[(0,l.Lk)("div",X,[t[7]||(t[7]=(0,l.Lk)("div",{class:"timeline-dot"},null,-1)),(0,l.Lk)("span",Q,(0,a.v_)(e.date),1)]),"grid"===s.viewMode?((0,l.uX)(),(0,l.CE)("div",O,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.items,e=>((0,l.uX)(),(0,l.Wv)(p,{key:e.time,cols:"6",sm:"4",md:"3",lg:"2"},{default:(0,l.k6)(()=>[(0,l.bF)(h,{class:"grid-item fill-height",elevation:"4",rounded:"lg"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",G,[r.isImage(e.name)?((0,l.uX)(),(0,l.Wv)(c,{key:0,src:e.url,cover:"","aspect-ratio":"1",class:"align-end"},{error:(0,l.k6)(()=>[(0,l.Lk)("div",J,[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[...t[8]||(t[8]=[(0,l.eW)("mdi-image-broken",-1)])]),_:1})])]),_:1},8,["src"])):r.isVideo(e.name)?((0,l.uX)(),(0,l.CE)("video",{key:1,src:e.url,muted:"",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,q)):((0,l.uX)(),(0,l.CE)("div",K,[(0,l.bF)(d,{size:"48",color:"primary"},{default:(0,l.k6)(()=>[...t[9]||(t[9]=[(0,l.eW)("mdi-file-document-outline",-1)])]),_:1})])),(0,l.Lk)("div",Y,[(0,l.Lk)("div",Z,[(0,l.bF)(u,{icon:"mdi-content-copy",size:"small",variant:"flat",color:"primary",onClick:(0,v.D$)(t=>r.copyLink(e.url),["stop"])},null,8,["onClick"]),(0,l.bF)(u,{icon:"mdi-open-in-new",size:"small",variant:"flat",class:"glass-btn",onClick:(0,v.D$)(t=>r.openLink(e.url),["stop"])},null,8,["onClick"]),(0,l.bF)(u,{icon:"mdi-delete",size:"small",variant:"flat",color:"error",onClick:(0,v.D$)(t=>r.deleteItem(e),["stop"])},null,8,["onClick"])])])]),(0,l.Lk)("div",ee,[(0,l.Lk)("div",{class:"text-truncate text-subtitle-2 font-weight-medium mb-1",title:e.name},(0,a.v_)(e.name),9,te),(0,l.Lk)("div",oe,(0,a.v_)(r.formatTime(e.time)),1)])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):((0,l.uX)(),(0,l.CE)("div",le,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.items,e=>((0,l.uX)(),(0,l.Wv)(h,{key:e.time,class:"list-item d-flex align-center pa-3",elevation:"2",rounded:"lg"},{default:(0,l.k6)(()=>[(0,l.bF)(f,{rounded:"lg",size:"50",class:"mr-4 bg-grey-lighten-4"},{default:(0,l.k6)(()=>[r.isImage(e.name)?((0,l.uX)(),(0,l.Wv)(c,{key:0,src:e.url,cover:""},null,8,["src"])):r.isVideo(e.name)?((0,l.uX)(),(0,l.CE)("video",{key:1,src:e.url,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,ae)):((0,l.uX)(),(0,l.Wv)(d,{key:2,color:"primary"},{default:(0,l.k6)(()=>[...t[10]||(t[10]=[(0,l.eW)("mdi-file-document-outline",-1)])]),_:1}))]),_:2},1024),(0,l.Lk)("div",ie,[(0,l.Lk)("div",se,(0,a.v_)(e.name),1),(0,l.Lk)("div",re,(0,a.v_)(e.url),1)]),(0,l.Lk)("div",ne,(0,a.v_)(r.formatTime(e.time)),1),(0,l.Lk)("div",de,[(0,l.bF)(u,{icon:"mdi-content-copy",size:"x-small",variant:"tonal",color:"primary",onClick:t=>r.copyLink(e.url)},null,8,["onClick"]),(0,l.bF)(u,{icon:"mdi-open-in-new",size:"x-small",variant:"tonal",onClick:t=>r.openLink(e.url)},null,8,["onClick"]),(0,l.bF)(u,{icon:"mdi-delete",size:"x-small",variant:"tonal",color:"error",onClick:t=>r.deleteItem(e)},null,8,["onClick"])])]),_:2},1024))),128))]))]))),128)),r.hasMore?((0,l.uX)(),(0,l.CE)("div",ue,[s.loadingMore?((0,l.uX)(),(0,l.CE)("div",ce,[(0,l.bF)(g,{indeterminate:"",size:"20",width:"2",color:"primary",class:"mr-2"}),t[11]||(t[11]=(0,l.Lk)("span",null,"加载中...",-1))])):((0,l.uX)(),(0,l.CE)("div",he,"下拉加载更多"))])):s.historyList.length>0?((0,l.uX)(),(0,l.CE)("div",pe,"没有更多记录了")):(0,l.Q3)("",!0)],544)):((0,l.uX)(),(0,l.CE)("div",me,[(0,l.bF)(d,{size:"64",class:"mb-4",color:"disabled"},{default:(0,l.k6)(()=>[...t[12]||(t[12]=[(0,l.eW)("mdi-history",-1)])]),_:1}),t[13]||(t[13]=(0,l.Lk)("p",{class:"text-h6"},"暂无上传记录",-1))]))],2)}var ge={name:"UploadHistory",props:{show:{type:Boolean,default:!1}},data(){return{historyList:[],allHistory:[],viewMode:"grid",pageSize:30,currentPage:0,loadingMore:!1,totalCount:0}},watch:{show(e){e&&this.resetAndLoad()}},computed:{hasMore(){return this.historyList.length<this.totalCount},groupedHistory(){const e={};return this.historyList.forEach(t=>{const o=new Date(t.time),l=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`;e[l]||(e[l]=[]),e[l].push(t)}),Object.keys(e).sort((e,t)=>new Date(t)-new Date(e)).map(t=>({date:t,items:e[t]}))}},mounted(){const e=localStorage.getItem("historyViewMode");e&&(this.viewMode=e)},methods:{resetAndLoad(){this.historyList=[],this.currentPage=0,this.loadAllHistory(),this.loadMore()},loadAllHistory(){try{const e=JSON.parse(localStorage.getItem("uploadHistory")||"[]");this.allHistory=e.sort((e,t)=>t.time-e.time),this.totalCount=this.allHistory.length}catch(e){console.error("Failed to load history",e),this.allHistory=[],this.totalCount=0}},loadMore(){!this.loadingMore&&this.hasMore&&(this.loadingMore=!0,setTimeout(()=>{const e=this.currentPage*this.pageSize,t=e+this.pageSize,o=this.allHistory.slice(e,t);this.historyList=[...this.historyList,...o],this.currentPage++,this.loadingMore=!1},50))},handleScroll(e){const t=e.target,o=t.scrollTop,l=t.scrollHeight,a=t.clientHeight;l-o-a<100&&this.loadMore()},toggleViewMode(){this.viewMode="grid"===this.viewMode?"list":"grid",localStorage.setItem("historyViewMode",this.viewMode)},clearHistory(){confirm("确定要清空所有上传记录吗？")&&(this.historyList=[],this.allHistory=[],this.totalCount=0,this.currentPage=0,localStorage.removeItem("uploadHistory"),this.$message.success("记录已清空"))},deleteItem(e){if(confirm("确定要删除这条记录吗？")){this.historyList=this.historyList.filter(t=>t.time!==e.time),this.allHistory=this.allHistory.filter(t=>t.time!==e.time),this.totalCount=this.allHistory.length;try{localStorage.setItem("uploadHistory",JSON.stringify(this.allHistory)),this.$message.success("记录已删除")}catch(t){}}},isImage(e){const t=["jpg","jpeg","png","gif","bmp","webp","svg","tiff","ico","avif","heic","jfif","pjpeg","pjp"],o=e?e.split(".").pop().toLowerCase():"";return t.includes(o)},isVideo(e){const t=["mp4","webm","ogg","mkv"],o=e?e.split(".").pop().toLowerCase():"";return t.includes(o)},formatTime(e){const t=new Date(e);return t.toLocaleString()},copyLink(e){navigator.clipboard.writeText(e).then(()=>{this.$message.success("链接已复制")}).catch(()=>{this.$message.error("复制失败")})},openLink(e){window.open(e,"_blank")}}};const ve=(0,I.A)(ge,[["render",fe],["__scopeId","data-v-36845a12"]]);var be=ve,ye=o(8065),Ce=o(144),ke=o(4570),we=o.n(ke),Fe=o(5114),Ue={name:"UploadHome",mixins:[ye.A],data(){return{selectedUrlForm:(0,Ce.KR)(""),showUrlDialog:!1,showCompressDialog:!1,customerCompress:!0,compressQuality:4,compressBar:5,convertToWebp:!1,serverCompress:!0,uploadChannel:"",channelName:"",availableChannels:{},uploadNameType:"",customUrlPrefix:"",useCustomUrl:"false",autoRetry:!0,uploadMethod:"default",uploadFolder:"",showAnnouncementDialog:!1,announcementContent:"",showHistory:!1,themeMode:"auto"}},watch:{customerCompress(e){this.updateCompressConfig("customerCompress",e)},compressQuality(e){this.updateCompressConfig("compressQuality",e)},compressBar(e){null===e||void 0===e||e<1?this.compressBar=1:(this.compressQuality>e&&(this.compressQuality=e),this.updateCompressConfig("compressBar",e))},serverCompress(e){this.updateCompressConfig("serverCompress",e)},convertToWebp(e){this.updateCompressConfig("convertToWebp",e)},uploadChannel(e){this.updateStoreUploadChannel(e);const t=this.availableChannels[e]||[],o=this.storeChannelName;o&&t.some(e=>e.name===o)?this.channelName=o:this.channelName=""},channelName(e){this.$store.commit("setStoreChannelName",e||"")},uploadNameType(e){this.updateStoreUploadNameType(e)},customUrlPrefix(e){this.$store.commit("setCustomUrlSettings",{key:"customUrlPrefix",value:e})},useCustomUrl(e){this.$store.commit("setCustomUrlSettings",{key:"useCustomUrl",value:e})},autoRetry(e){this.$store.commit("setStoreAutoRetry",e)},uploadFolder(e){this.validateUploadFolder(e)?this.$store.commit("setStoreUploadFolder",e):this.$nextTick(()=>{this.uploadFolder=this.storeUploadFolder})}},computed:{...(0,D.L8)(["userConfig","uploadCopyUrlForm","compressConfig","storeUploadChannel","storeChannelName","storeUploadNameType","customUrlSettings","storeAutoRetry","storeUploadMethod","storeUploadFolder","cusDarkMode","useDarkMode"]),ownerName(){return this.userConfig?.ownerName||"Sanyue"},urlPrefix(){return this.userConfig?.urlPrefix||`${window.location.protocol}//${window.location.host}/file/`},announcementAvailable(){return!!this.userConfig?.announcement},currentChannelList(){return this.availableChannels[this.uploadChannel]||[]}},mounted(){this.initializeBackground("uploadBkImg",".upload-home",!1,!0),this.selectedUrlForm=this.uploadCopyUrlForm||"url",this.customerCompress=this.compressConfig.customerCompress??this.parseBoolean(this.userConfig?.defaultCustomerCompress,!0),this.compressQuality=this.compressConfig.compressQuality??this.parseNumber(this.userConfig?.defaultCompressQuality,4),this.compressBar=this.compressConfig.compressBar??this.parseNumber(this.userConfig?.defaultCompressBar,5),this.serverCompress=this.compressConfig.serverCompress??!0,this.convertToWebp=this.compressConfig.convertToWebp??this.parseBoolean(this.userConfig?.defaultConvertToWebp,!1),this.uploadChannel=this.storeUploadChannel||this.userConfig?.defaultUploadChannel||"telegram",this.autoRetry=this.storeAutoRetry,this.uploadNameType=this.storeUploadNameType||this.userConfig?.defaultUploadNameType||"default",this.customUrlPrefix=this.customUrlSettings.customUrlPrefix,this.useCustomUrl=this.customUrlSettings.useCustomUrl,this.uploadMethod=this.storeUploadMethod,this.fetchAvailableChannels(),this.uploadFolder=this.storeUploadFolder||this.userConfig?.defaultUploadFolder||"",this.cusDarkMode?this.useDarkMode?this.themeMode="dark":this.themeMode="light":this.themeMode="auto";const e=localStorage.getItem("visitedUploadHome"),t=this.userConfig?.announcement;!e&&t&&(this.announcementContent=t,this.showAnnouncementDialog=!0,localStorage.setItem("visitedUploadHome","true"))},components:{UploadForm:P,Footer:W.A,ToggleDark:A.A,Logo:V.A,UploadHistory:be},methods:{async fetchAvailableChannels(){try{const e=await R.A.get("/api/channels");if(e.data){this.availableChannels=e.data;const t=this.storeChannelName,o=this.userConfig?.defaultChannelName,l=this.availableChannels[this.uploadChannel]||[];t&&l.some(e=>e.name===t)?this.channelName=t:""!==t&&null!==t&&void 0!==t||""!==t&&o&&l.some(e=>e.name===o)&&(this.channelName=o)}}catch(e){console.error("Failed to fetch available channels:",e)}},validateUploadFolder(e){const t=(0,Fe.G)(e);return!!t.valid||(this.$message.error(t.error.replace("目标目录","上传目录")),!1)},handleManage(){this.$router.push("/dashboard")},parseBoolean(e,t){return void 0===e||null===e?t:"boolean"===typeof e?e:"string"===typeof e?"true"===e:t},parseNumber(e,t){if(void 0===e||null===e)return t;const o=parseFloat(e);return isNaN(o)?t:o},openUrlDialog(){this.showUrlDialog=!0},handleLogout(){we().remove("authCode"),this.$router.push("/login"),this.$message.success("已退出登录")},changeUrlForm(){this.$store.commit("setUploadCopyUrlForm",this.selectedUrlForm)},openCompressDialog(){this.showCompressDialog=!0},updateCompressConfig(e,t){this.$store.commit("setCompressConfig",{key:e,value:t})},updateStoreUploadChannel(e){this.$store.commit("setStoreUploadChannel",e)},updateStoreUploadNameType(e){this.$store.commit("setStoreUploadNameType",e)},handleChangeUploadMethod(){this.uploadMethod="default"===this.uploadMethod?"paste":"default",this.$store.commit("setUploadMethod",this.uploadMethod)},handleMobileMenuCommand(e){"toggleTheme"===e?"auto"===this.themeMode?(this.themeMode="light",this.$store.commit("setCusDarkMode",!0),this.$store.commit("setUseDarkMode",!1)):"light"===this.themeMode?(this.themeMode="dark",this.$store.commit("setCusDarkMode",!0),this.$store.commit("setUseDarkMode",!0)):(this.themeMode="auto",this.$store.commit("setCusDarkMode",!1)):"toggleUploadMethod"===e&&this.handleChangeUploadMethod()},getThemeIcon(){return"auto"===this.themeMode?"mdi-brightness-auto":"light"===this.themeMode?"mdi-weather-night":"mdi-weather-sunny"},getThemeText(){return"auto"===this.themeMode?"浅色模式":"light"===this.themeMode?"深色模式":"自动模式"},handleShowAnnouncement(){this.userConfig?.announcement?(this.announcementContent=this.userConfig.announcement,this.showAnnouncementDialog=!0):this.$message.info("暂无公告")}}};const xe=(0,I.A)(Ue,[["render",g],["__scopeId","data-v-66cec26a"]]);var Le=xe},5114:function(e,t,o){"use strict";function l(e){if(!e||""===e.trim())return{valid:!0};if("/"===e)return{valid:!0};if(!e.startsWith("/"))return{valid:!1,error:'目标目录必须以 "/" 开头'};const t=/[\\:\*\?"'<>\| \(\)\[\]\{\}#%\^`~;@&=\+\$,]/;return t.test(e)?{valid:!1,error:"目标目录包含非法字符，请使用合法的路径格式"}:e.includes("//")?{valid:!1,error:"目标目录不能包含连续的斜杠"}:{valid:!0}}o.d(t,{G:function(){return l}})},6334:function(e,t,o){e.exports=o(1393)},6682:function(e,t,o){"use strict";e.exports=o.p+"img/404.8ed11fb3.png"}}]);
//# sourceMappingURL=764.972bc847.js.map