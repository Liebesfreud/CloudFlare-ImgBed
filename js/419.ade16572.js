"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[419],{200:function(e,t,a){a(5331)},213:function(e,t,a){a(5331),a(9104)},670:function(e,t,a){a(5331),a(9648),a(9104),a(5970)},694:function(e,t,a){a(5331)},797:function(e,t,a){a.d(t,{A:function(){return s}});a(4114),a(4979);var n=a(5507),o=a(1219),i=a(6915);async function s(e,t={}){const a=n.A.getters.credentials||btoa("unset:unset");t.headers={...t.headers,Authorization:`Basic ${a}`},t.credentials="include";const s=await fetch(e,t);return 401===s.status&&(o.nk.error("认证状态错误，请重新登录"),i.A.push("/adminLogin")),s}},2907:function(e,t,a){a(5331),a(6808),a(6711)},3597:function(e,t,a){a(5331)},4035:function(e,t,a){a.d(t,{A:function(){return x}});var n=a(6768),o=a(5130),i=a(4232);const s={id:"themeMaskAdmin"},l=["cx","cy","r"],r=["r"],c=["opacity"];function d(e,t,a,d,u,m){const h=(0,n.g2)("font-awesome-icon");return(0,n.uX)(),(0,n.CE)("div",{id:"themeToggle",onClick:t[0]||(t[0]=(...e)=>m.handleToggleClick&&m.handleToggleClick(...e))},[(0,n.bF)(o.eB,{name:"icon-fade",mode:"out-in"},{default:(0,n.k6)(()=>[m.isAuto?((0,n.uX)(),(0,n.Wv)(h,{key:"auto-mode",icon:"circle-half-stroke",class:"auto-icon",style:{"font-size":"1.3em",color:"var(--admin-theme-toggle-color)"}})):((0,n.uX)(),(0,n.CE)("svg",{key:"sun-moon",class:(0,i.C4)(["theme_toggle_svg",{dark:m.isDark}]),width:"1.3em",height:"1.3em",viewBox:"0 0 24 24",fill:"none","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",stroke:"currentColor"},[(0,n.Lk)("mask",s,[t[1]||(t[1]=(0,n.Lk)("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"white"},null,-1)),(0,n.Lk)("circle",{class:"theme_toggle_circle1",fill:"black",cx:m.isDark?"50%":"100%",cy:m.isDark?"23%":"0%",r:m.isDark?"9":"5"},null,8,l)]),(0,n.Lk)("circle",{class:"theme_toggle_circle2",cx:"12",cy:"12",r:m.isDark?"9":"5",mask:"url(#themeMaskAdmin)"},null,8,r),(0,n.Lk)("g",{class:"theme_toggle_g",stroke:"currentColor",opacity:m.isDark?0:1},[...t[2]||(t[2]=[(0,n.Lk)("line",{x1:"12",y1:"1",x2:"12",y2:"3"},null,-1),(0,n.Lk)("line",{x1:"12",y1:"21",x2:"12",y2:"23"},null,-1),(0,n.Lk)("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"},null,-1),(0,n.Lk)("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"},null,-1),(0,n.Lk)("line",{x1:"1",y1:"12",x2:"3",y2:"12"},null,-1),(0,n.Lk)("line",{x1:"21",y1:"12",x2:"23",y2:"12"},null,-1),(0,n.Lk)("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"},null,-1),(0,n.Lk)("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"},null,-1)])],8,c)],2))]),_:1})])}var u={name:"ToggleDark",computed:{isDark(){return this.$store.getters.useDarkMode},isAuto(){return!this.$store.getters.cusDarkMode}},methods:{handleToggleClick(){this.isAuto?(this.$store.commit("setCusDarkMode",!0),this.$store.commit("setUseDarkMode",!1)):this.isDark?this.$store.commit("setCusDarkMode",!1):(this.$store.commit("setCusDarkMode",!0),this.$store.commit("setUseDarkMode",!0))}}},m=a(1241);const h=(0,m.A)(u,[["render",d],["__scopeId","data-v-093a256a"]]);var g=h,p=a(2086);a(5331),a(670),a(8830),a(3597);const k={class:"dashboard-tabs"},b={class:"dropdown-trigger"},f={class:"dropdown-item-content"},y={class:"dropdown-item-content"},C={class:"dropdown-item-content"},v={class:"dropdown-item-content"};function w(e,t,a,o,s,l){const r=(0,n.g2)("font-awesome-icon"),c=p.c6,d=p.Iy,u=p.dW,m=g;return(0,n.uX)(),(0,n.CE)("div",k,[(0,n.Lk)("span",{class:"tab-item tab-active",onClick:t[0]||(t[0]=(...e)=>l.refreshDashboard&&l.refreshDashboard(...e))},[(0,n.bF)(r,{icon:l.iconName,class:"tab-icon"},null,8,["icon"]),(0,n.eW)(" "+(0,i.v_)(l.titleName),1)]),(0,n.bF)(u,{onCommand:l.handleTabClick,class:"tabs-dropdown",role:"navigation",onVisibleChange:l.handleDropdownVisible,"popper-class":"tabs-dropdown-popper"},{dropdown:(0,n.k6)(()=>[(0,n.bF)(d,null,{default:(0,n.k6)(()=>["dashboard"!==a.activeTab?((0,n.uX)(),(0,n.Wv)(c,{key:0,command:"dashboard"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",f,[(0,n.bF)(r,{icon:"images",class:"item-icon"}),t[1]||(t[1]=(0,n.Lk)("span",null,"文件管理",-1))])]),_:1})):(0,n.Q3)("",!0),"customerConfig"!==a.activeTab?((0,n.uX)(),(0,n.Wv)(c,{key:1,command:"customerConfig"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",y,[(0,n.bF)(r,{icon:"user-cog",class:"item-icon"}),t[2]||(t[2]=(0,n.Lk)("span",null,"用户管理",-1))])]),_:1})):(0,n.Q3)("",!0),"systemConfig"!==a.activeTab?((0,n.uX)(),(0,n.Wv)(c,{key:2,command:"systemConfig"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",C,[(0,n.bF)(r,{icon:"cogs",class:"item-icon"}),t[3]||(t[3]=(0,n.Lk)("span",null,"系统设置",-1))])]),_:1})):(0,n.Q3)("",!0),(0,n.bF)(c,{command:""},{default:(0,n.k6)(()=>[(0,n.Lk)("div",v,[(0,n.bF)(r,{icon:"upload",class:"item-icon"}),t[4]||(t[4]=(0,n.Lk)("span",null,"文件上传",-1))])]),_:1})]),_:1})]),default:(0,n.k6)(()=>[(0,n.Lk)("span",b,[(0,n.bF)(r,{icon:"bars",class:"dropdown-icon"})])]),_:1},8,["onCommand","onVisibleChange"]),(0,n.bF)(m)])}a(4114);var L={name:"DashboardTabs",props:{activeTab:{type:String,default:"dashboard"}},components:{AdminToggleDark:g},computed:{titleName(){const e={dashboard:"文件管理",customerConfig:"用户管理",systemConfig:"系统设置",upload:"文件上传"};return e[this.activeTab]||"文件管理"},iconName(){const e={dashboard:"images",customerConfig:"user-cog",systemConfig:"cogs",upload:"upload"};return e[this.activeTab]||"images"}},methods:{refreshDashboard(){location.reload()},handleTabClick(e){this.$router.push(`/${e}`)},handleDropdownVisible(e){const t=document.querySelector(".dropdown-trigger");t&&(e?t.classList.add("is-open"):t.classList.remove("is-open"))}}};const D=(0,m.A)(L,[["render",w],["__scopeId","data-v-5229681c"]]);var x=D},4318:function(){},4752:function(e,t,a){a(5331),a(8736),a(8785)},5802:function(e,t,a){a(5331),a(8736),a(213),a(5970)},5970:function(e,t,a){a(5331)},6808:function(e,t,a){a(5331),a(8785),a(200),a(5970),a(9104)},7128:function(e,t,a){a(5331),a(4318)},8075:function(e,t,a){a(5331)},8419:function(e,t,a){a.r(t),a.d(t,{default:function(){return _}});var n=a(9114),o=(a(5331),a(694),a(47)),i=(a(9648),a(7815)),s=(a(2907),a(5558)),l=(a(8075),a(7138)),r=(a(5802),a(7009)),c=(a(8450),a(4752),a(4880)),d=(a(7128),a(8507)),u=(a(213),a(4035)),m=a(6768),h=a(4232);const g={class:"container"},p={class:"header-content"},k={class:"header-action"},b={class:"main-container"},f={style:{margin:"8px"}},y=["src"],C={key:2,style:{width:"100px",height:"100px",display:"flex","justify-content":"center","align-items":"center"}},v={class:"pagination-container"};function w(e,t,a,w,L,D){const x=u.A,T=(0,m.g2)("font-awesome-icon"),_=d.R7,F=c.bZ,A=l.o8,S=r.Zq,z=l.Up,$=s.qi,E=i.aQ,M=o.S2,W=n.A;return(0,m.uX)(),(0,m.CE)("div",g,[(0,m.bF)(F,null,{default:(0,m.k6)(()=>[(0,m.Lk)("div",p,[(0,m.bF)(x,{activeTab:"customerConfig"}),(0,m.Lk)("div",k,[(0,m.bF)(_,{disabled:D.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,m.k6)(()=>[(0,m.bF)(T,{icon:"sign-out-alt",class:"header-icon",onClick:D.handleLogout},null,8,["onClick"])]),_:1},8,["disabled"])])])]),_:1}),(0,m.Lk)("div",b,[(0,m.bo)(((0,m.uX)(),(0,m.Wv)(z,{data:D.paginatedData,"default-sort":{prop:"count",order:"descending"},class:"main-table","table-layout":"fixed"},{default:(0,m.k6)(()=>[(0,m.bF)(A,{type:"expand"},{default:(0,m.k6)(e=>[(0,m.Lk)("div",f,[t[0]||(t[0]=(0,m.Lk)("h3",{style:{"text-align":"center"}},"上传文件列表",-1)),(0,m.bF)(z,{data:e.row.data,style:{width:"100%"},"default-sort":{prop:"metadata.TimeStamp",order:"descending"},"table-layout":"fixed","max-height":400},{default:(0,m.k6)(()=>[(0,m.bF)(A,{prop:"metadata.FileName",label:"文件名"}),(0,m.bF)(A,{label:"文件预览"},{default:(0,m.k6)(({row:e})=>[e.metadata?.FileType?.includes("image")?((0,m.uX)(),(0,m.Wv)(S,{key:0,src:"/file/"+e.id+"?from=admin",fit:"cover",lazy:"",style:{width:"100px",height:"100px"}},null,8,["src"])):e.metadata?.FileType?.includes("video")?((0,m.uX)(),(0,m.CE)("video",{key:1,src:"/file/"+e.id+"?from=admin",controls:"",style:{width:"100px",height:"100px"}},null,8,y)):((0,m.uX)(),(0,m.CE)("div",C,[(0,m.bF)(T,{icon:"file",style:{"font-size":"2em"}})]))]),_:1}),(0,m.bF)(A,{formatter:D.formatTimeStamp,label:"上传时间",prop:"metadata.TimeStamp",sortable:"","sort-method":D.sortByTimestamp},{default:(0,m.k6)(({row:e})=>[(0,m.eW)((0,h.v_)(D.formatTimeStamp(e.metadata.TimeStamp)),1)]),_:1},8,["formatter","sort-method"])]),_:1},8,["data"])])]),_:1}),(0,m.bF)(A,{prop:"ip",label:"IP地址"}),(0,m.bF)(A,{prop:"address",label:"地址"}),(0,m.bF)(A,{prop:"count",label:"上传次数",sortable:""}),(0,m.bF)(A,{label:"允许上传"},{default:(0,m.k6)(({row:e})=>[(0,m.bF)($,{modelValue:e.enable,"onUpdate:modelValue":t=>e.enable=t,"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"允许","inactive-text":"禁止",onChange:t=>D.handleSwitchEnable(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})]),_:1},8,["data"])),[[W,L.loading]]),(0,m.Lk)("div",v,[(0,m.bF)(E,{background:"",layout:"prev, pager, next",total:L.dealedData.length,"current-page":L.currentPage,"page-size":L.pageSize,"pager-count":D.pagerCount,onCurrentChange:D.handlePageChange},null,8,["total","current-page","page-size","pager-count","onCurrentChange"]),L.currentPage===Math.ceil(L.dealedData.length/L.pageSize)?((0,m.uX)(),(0,m.Wv)(M,{key:0,type:"primary",onClick:D.loadMoreData,loading:L.loading,class:"load-more"},{default:(0,m.k6)(()=>[...t[1]||(t[1]=[(0,m.eW)("加载更多",-1)])]),_:1},8,["onClick","loading"])):(0,m.Q3)("",!0)])])])}a(4114),a(8111),a(2489),a(1701);var L=a(797),D={name:"CustomerConfig",data(){return{tableData:[],dealedData:[],blockipList:[],loading:!1,currentPage:1,pageSize:10}},components:{DashboardTabs:u.A},computed:{disableTooltip(){return window.innerWidth<768},pagerCount(){return window.innerWidth<768?3:7},paginatedData(){const e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.dealedData.slice(e,t)}},methods:{handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},formatTimeStamp(e){return new Date(e).toLocaleString()},sortByTimestamp(e,t){return new Date(e.metadata.TimeStamp)-new Date(t.metadata.TimeStamp)},async handleSwitchEnable(e){const t=e.ip,a=e.enable;a?(this.blockipList=this.blockipList.filter(e=>e!==t),await(0,L.A)("/api/manage/cusConfig/whiteip",{method:"POST",body:t})):(this.blockipList.push(t),await(0,L.A)("/api/manage/cusConfig/blockip",{method:"POST",body:t}))},handlePageChange(e){this.currentPage=e,e===Math.ceil(this.dealedData.length/this.pageSize)&&this.loadMoreData()},loadMoreData(){this.loading=!0;const e=this.dealedData.length,t=20;(0,L.A)(`/api/manage/cusConfig/list?start=${e}&count=${t}`,{method:"GET"}).then(e=>e.json()).then(e=>{this.dealedData=this.dealedData.concat(e.map(e=>{const t=!this.blockipList.includes(e.ip);return{ip:e.ip,address:e.address,count:e.count,data:e.data,enable:t}}))}).catch(()=>{this.$message.error("加载更多数据时出错，请检查网络连接")}).finally(()=>{this.loading=!1})},handleSizeChange(e){this.pageSize=e,this.currentPage=1}},mounted(){this.loading=!0,(0,L.A)("/api/manage/check",{method:"GET"}).then(e=>e.text()).then(e=>{if("true"==e)return this.showLogoutButton=!0,(0,L.A)("/api/manage/cusConfig/list?count=20",{method:"GET"});if("Not using basic auth."==e)return(0,L.A)("/api/manage/cusConfig/list?count=20",{method:"GET"});throw new Error("Unauthorized")}).then(e=>e.json()).then(async e=>{const t=await(0,L.A)("/api/manage/cusConfig/blockipList",{method:"GET"});this.blockipList=(await t.text()).split(","),this.dealedData=e.map(e=>{const t=!this.blockipList.includes(e.ip);return{ip:e.ip,address:e.address,count:e.count,data:e.data,enable:t}})}).catch(e=>{"Unauthorized"!==e.message&&this.$message.error("同步数据时出错，请检查网络连接")}).finally(()=>{this.loading=!1})}},x=a(1241);const T=(0,x.A)(D,[["render",w],["__scopeId","data-v-1c7a5eff"]]);var _=T},8450:function(e,t,a){a(5331)},8736:function(e,t,a){a(5331)},8785:function(e,t,a){a(5331)},8830:function(e,t,a){a(5331)},9104:function(e,t,a){a(5331)}}]);
//# sourceMappingURL=419.ade16572.js.map